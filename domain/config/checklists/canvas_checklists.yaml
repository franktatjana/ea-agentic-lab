# Canvas Checklists
# Validation rules for canvas rendering executed by PB_952
version: "1.0"

# ==============================================================================
# COMPLETENESS CHECKS
# ==============================================================================
completeness:
  - rule_id: CHK_CVS_001
    name: "Required sections populated"
    assertion: "ALL(canvas.spec.required_sections, NOT_EMPTY)"
    severity: error
    message: "Canvas missing required section: ${missing_section}"

  - rule_id: CHK_CVS_002
    name: "Source data exists"
    assertion: "ALL(canvas.spec.sources, EXISTS($.path))"
    severity: error
    message: "Canvas source not found: ${missing_source}"

  - rule_id: CHK_CVS_003
    name: "Minimum items per section"
    assertion: "ALL(canvas.sections, LENGTH >= spec.min_items OR spec.min_items == null)"
    severity: warning
    message: "Section ${section} below minimum items"

# ==============================================================================
# FRESHNESS CHECKS
# ==============================================================================
freshness:
  - rule_id: CHK_CVS_010
    name: "Canvas not stale"
    assertion: "DAYS_SINCE(canvas.last_rendered) <= canvas.spec.cadence.days_threshold"
    severity: warning
    message: "Canvas stale: last rendered ${days_ago} days ago"
    auto_fix_playbook: PB_951

  - rule_id: CHK_CVS_011
    name: "Source data fresher than canvas"
    assertion: "ALL(canvas.sources, source.updated_at <= canvas.last_rendered)"
    severity: warning
    message: "Source data updated since last render"
    auto_fix_playbook: PB_951

# ==============================================================================
# CONSISTENCY CHECKS
# ==============================================================================
consistency:
  - rule_id: CHK_CVS_020
    name: "No orphan references"
    assertion: "ALL(canvas.references, EXISTS(target))"
    severity: error
    message: "Canvas references deleted artifact: ${orphan_ref}"

  - rule_id: CHK_CVS_021
    name: "Stakeholders match stakeholder map"
    assertion: "ALL(canvas.stakeholders, EXISTS_IN(stakeholder_map))"
    severity: warning
    message: "Canvas stakeholder not in stakeholder map: ${mismatch}"

  - rule_id: CHK_CVS_022
    name: "Risks match risk register"
    assertion: "ALL(canvas.risks, EXISTS_IN(risk_register))"
    severity: warning
    message: "Canvas risk not in risk register: ${mismatch}"

# ==============================================================================
# QUALITY CHECKS
# ==============================================================================
quality:
  - rule_id: CHK_CVS_030
    name: "No empty sections"
    assertion: "ALL(canvas.sections, LENGTH > 0 OR spec.optional == true)"
    severity: warning
    message: "Canvas has empty section: ${empty_section}"

  - rule_id: CHK_CVS_031
    name: "Max items respected"
    assertion: "ALL(canvas.sections, LENGTH <= spec.max_items OR spec.max_items == null)"
    severity: warning
    message: "Section ${section} exceeds max items"

  - rule_id: CHK_CVS_032
    name: "HTML renders without errors"
    assertion: "canvas.html.render_errors == 0"
    severity: error
    message: "Canvas HTML has render errors"

  - rule_id: CHK_CVS_033
    name: "Markdown renders without errors"
    assertion: "canvas.markdown.render_errors == 0"
    severity: error
    message: "Canvas Markdown has render errors"

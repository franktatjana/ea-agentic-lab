# Playbook Checklists
# Machine-readable validation rules executed by PB_970
version: "1.0"

# ==============================================================================
# PRE-EXECUTION CHECKS
# ==============================================================================
pre_execution:
  - rule_id: CHK_PRE_001
    name: "Required inputs available"
    assertion: "ALL(playbook.required_inputs, EXISTS($.path))"
    severity: error
    message: "Missing required input: ${missing_input}"
    auto_fix_playbook: null

  - rule_id: CHK_PRE_002
    name: "Node profile exists"
    assertion: "EXISTS(${paths.node_profile})"
    severity: error
    message: "Node profile not found"
    auto_fix_playbook: null

  - rule_id: CHK_PRE_003
    name: "Operating mode allows playbook"
    assertion: "playbook.id NOT IN mode_matrix[node.operating_mode].blocked"
    severity: error
    message: "Playbook ${playbook.id} blocked for mode ${node.operating_mode}"
    auto_fix_playbook: null

  - rule_id: CHK_PRE_004
    name: "Evidence requirements met"
    assertion: "ALL(playbook.required_evidence, VALID)"
    severity: warning
    message: "Missing evidence: ${missing_evidence}"
    auto_fix_playbook: null

# ==============================================================================
# POST-EXECUTION CHECKS
# ==============================================================================
post_execution:
  - rule_id: CHK_POST_001
    name: "Outputs schema valid"
    assertion: "ALL(run.outputs, SCHEMA_VALID)"
    severity: error
    message: "Output ${output.path} failed schema validation"
    auto_fix_playbook: null

  - rule_id: CHK_POST_002
    name: "Outputs have provenance"
    assertion: "ALL(run.outputs, EXISTS($.provenance))"
    severity: error
    message: "Output missing provenance block"
    auto_fix_playbook: null

  - rule_id: CHK_POST_003
    name: "No contradictions with InfoHub"
    assertion: "NOT(CONTRADICTS(run.outputs, infohub))"
    severity: warning
    message: "Output contradicts existing artifact: ${conflict}"
    auto_fix_playbook: null

  - rule_id: CHK_POST_004
    name: "Version incremented"
    assertion: "run.output.version > existing.version OR NOT(EXISTS(existing))"
    severity: warning
    message: "Version not incremented from previous"
    auto_fix_playbook: null

# ==============================================================================
# QUALITY CHECKS
# ==============================================================================
quality:
  - rule_id: CHK_QUAL_001
    name: "Minimum content threshold"
    assertion: "LENGTH(run.output.content) >= playbook.min_content_length"
    severity: warning
    message: "Output content below minimum threshold"
    auto_fix_playbook: null

  - rule_id: CHK_QUAL_002
    name: "Required sections present"
    assertion: "ALL(playbook.required_sections, EXISTS)"
    severity: error
    message: "Missing required section: ${missing_section}"
    auto_fix_playbook: null

  - rule_id: CHK_QUAL_003
    name: "No placeholder text"
    assertion: "NOT(CONTAINS(run.output, ['TBD', 'TODO', 'FIXME', 'XXX']))"
    severity: warning
    message: "Output contains placeholder text"
    auto_fix_playbook: null

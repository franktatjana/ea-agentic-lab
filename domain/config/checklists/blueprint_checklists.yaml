# Blueprint Checklists
# Cross-cutting governance rules executed by PB_971
version: "1.0"

# ==============================================================================
# NODE-LEVEL CHECKS
# ==============================================================================
node_level:
  - rule_id: CHK_NODE_001
    name: "Node profile complete"
    assertion: "EXISTS(node.name) AND EXISTS(node.stage) AND EXISTS(node.operating_mode)"
    severity: error
    evidence_path: "${paths.node_profile}"
    auto_fix_playbook: null

  - rule_id: CHK_NODE_002
    name: "Stakeholder map exists"
    assertion: "EXISTS(${paths.stakeholders}/stakeholder_map.yaml)"
    severity: warning
    staleness_days: 30
    auto_fix_playbook: PB_102

  - rule_id: CHK_NODE_003
    name: "Economic buyer identified"
    assertion: "EXISTS(stakeholder_map.economic_buyer)"
    severity: error
    evidence_path: "${paths.stakeholders}/stakeholder_map.yaml"
    auto_fix_playbook: PB_102

  - rule_id: CHK_NODE_004
    name: "Risk register exists"
    assertion: "EXISTS(${paths.risks}/risk_register.yaml)"
    severity: warning
    staleness_days: 7
    auto_fix_playbook: OP_RSK_001

  - rule_id: CHK_NODE_005
    name: "Core canvases rendered"
    assertion: "EXISTS(canvas/context_canvas.html) AND EXISTS(canvas/decision_canvas.html)"
    severity: warning
    staleness_days: 7
    auto_fix_playbook: PB_951

  - rule_id: CHK_NODE_006
    name: "Health score current"
    assertion: "DAYS_SINCE(health_score.updated_at) <= 7"
    severity: warning
    evidence_path: "${paths.governance}/health_score.yaml"
    auto_fix_playbook: PB_401

# ==============================================================================
# REALM-LEVEL CHECKS
# ==============================================================================
realm_level:
  - rule_id: CHK_REALM_001
    name: "Realm profile complete"
    assertion: "EXISTS(realm.name) AND EXISTS(realm.industry) AND EXISTS(realm.tier)"
    severity: error
    evidence_path: "${paths.realm_profile}"
    auto_fix_playbook: null

  - rule_id: CHK_REALM_002
    name: "At least one active node"
    assertion: "COUNT(realm.nodes WHERE status == 'active') >= 1"
    severity: warning
    auto_fix_playbook: null

  - rule_id: CHK_REALM_003
    name: "No orphan nodes"
    assertion: "ALL(realm.nodes, EXISTS(node_profile.yaml))"
    severity: error
    auto_fix_playbook: null

# ==============================================================================
# BLUEPRINT-LEVEL CHECKS
# ==============================================================================
blueprint_level:
  - rule_id: CHK_BP_001
    name: "All agents registered"
    assertion: "COUNT(agent_catalog.agents) == 24"
    severity: error
    evidence_path: "config/agent_catalog.yaml"
    auto_fix_playbook: null

  - rule_id: CHK_BP_002
    name: "Signal catalog complete"
    assertion: "ALL(signals, EXISTS(producer) AND LENGTH(consumers) > 0)"
    severity: warning
    evidence_path: "config/signal_catalog.yaml"
    auto_fix_playbook: null

  - rule_id: CHK_BP_003
    name: "All playbooks have owner"
    assertion: "ALL(playbooks, EXISTS(intended_agent_role))"
    severity: error
    auto_fix_playbook: null

  - rule_id: CHK_BP_004
    name: "Canvas specs have templates"
    assertion: "ALL(canvas_specs, EXISTS(template_path))"
    severity: error
    auto_fix_playbook: null

  - rule_id: CHK_BP_005
    name: "Thresholds defined"
    assertion: "EXISTS(config/thresholds.yaml)"
    severity: error
    auto_fix_playbook: null

# ==============================================================================
# STALENESS CHECKS
# ==============================================================================
staleness:
  - rule_id: CHK_STALE_001
    name: "Meeting notes processed"
    assertion: "ALL(meetings, DAYS_SINCE(processed_at) <= 3)"
    severity: warning
    auto_fix_playbook: OP_MTG_001

  - rule_id: CHK_STALE_002
    name: "Decisions reviewed"
    assertion: "ALL(decisions WHERE status == 'pending', DAYS_SINCE(created_at) <= 14)"
    severity: warning
    auto_fix_playbook: null

  - rule_id: CHK_STALE_003
    name: "Risks assessed"
    assertion: "ALL(risks WHERE status == 'identified', DAYS_SINCE(created_at) <= 7)"
    severity: warning
    auto_fix_playbook: null

  - rule_id: CHK_STALE_004
    name: "Actions not overdue"
    assertion: "COUNT(actions WHERE due_date < TODAY AND status != 'completed') == 0"
    severity: warning
    auto_fix_playbook: OP_ESC_001

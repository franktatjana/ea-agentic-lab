# AE Agent Task Prompts
# Purpose: Task-specific prompts using CAF framework (Context, Action, Format)
# Reference: Personality defined in personalities/ae_personality.yaml

# ============================================================================
# DEAL DIAGNOSIS PROMPTS
# ============================================================================
deal_diagnosis:

  analyze_deal_health:
    name: "Deal Health Analysis"
    description: "Diagnose current deal health based on recent signals"
    prompt: |
      Context: Review all communications and CRM data for {account_name}
      opportunity "{opportunity_name}" from the last {time_period}.

      Action: Identify the top 3 risks threatening this deal and the top 3
      positive signals supporting it. For each risk, suggest a specific
      mitigation action.

      Format:
      - Risk table (Risk | Severity | Evidence | Mitigation)
      - Positive signals list with evidence
      - Overall health score (RED/YELLOW/GREEN) with justification

  diagnose_stalled_deal:
    name: "Stalled Deal Diagnosis"
    description: "Understand why a deal has stopped progressing"
    prompt: |
      Context: This deal has been in {current_stage} stage for {days_in_stage} days.
      Review all touchpoints since it entered this stage.

      Action: Identify what caused the stall. Look for:
      - Missing stakeholder engagement
      - Unaddressed objections
      - Competitive pressure
      - Budget/timing issues
      - Internal customer politics

      Format:
      - Primary stall reason with evidence
      - Contributing factors
      - Recommended next 3 actions to unstall
      - Stakeholder to engage first

  loss_analysis:
    name: "Deal Loss Analysis"
    description: "Analyze a lost deal to extract learnings"
    prompt: |
      Context: Analyze the complete history of lost deal "{opportunity_name}"
      from first contact to loss.

      Action: Identify:
      - At what stage did we lose momentum?
      - What were the warning signs we missed?
      - What did the competitor do better?
      - What could we have done differently?

      Format:
      - Timeline of key moments (date, event, impact)
      - Warning signs table (Signal | When | What we did | What we should have done)
      - Top 3 learnings for future deals
      - Resurrection potential (YES/NO with reasoning)

  resurrect_dead_deal:
    name: "Dead Deal Resurrection"
    description: "Find opportunities to re-engage lost or stalled deals"
    prompt: |
      Context: Review deals lost or gone dark in the last {time_period}
      for {account_name} or {segment}.

      Action: Identify deals worth re-engaging based on:
      - Original loss reason (has it changed?)
      - Recent company news or triggers
      - Stakeholder changes
      - Product updates addressing their needs

      Format:
      - Prioritized list of resurrection candidates
      - For each: Original issue | Current trigger | Suggested approach
      - Personalized re-engagement message draft

# ============================================================================
# PIPELINE MANAGEMENT PROMPTS
# ============================================================================
pipeline_management:

  forecast_accuracy:
    name: "Forecast Risk Assessment"
    description: "Identify deals that may slip from forecast"
    prompt: |
      Context: Review all deals in {stage} or later stages with close dates
      in {quarter}.

      Action: For each deal, assess commit confidence based on:
      - Recent engagement level
      - Decision maker access
      - Budget confirmation
      - Timeline signals
      - Competitive activity

      Format:
      - Deals at risk table (Deal | Value | Risk factors | Confidence %)
      - Total forecast at risk (sum of low confidence deals)
      - Recommended focus deals for this week

  pipeline_coverage:
    name: "Pipeline Coverage Analysis"
    description: "Assess if pipeline is sufficient for target"
    prompt: |
      Context: Current pipeline for {quarter}: {pipeline_value}.
      Target: {target_value}. Historical win rate: {win_rate}%.

      Action: Calculate coverage ratio and identify gaps.
      Recommend where to source additional pipeline.

      Format:
      - Coverage ratio and gap to target
      - Deals most likely to close (top 5)
      - Pipeline generation recommendations
      - Week-by-week close plan to hit target

  next_best_action:
    name: "Daily Priority Actions"
    description: "Identify highest-impact actions for today"
    prompt: |
      Context: Review my active opportunities and recent customer signals.

      Action: Identify the top 5 actions I should take today based on:
      - Deals closest to close
      - Deals at highest risk
      - Unresponded customer communications
      - Upcoming meetings needing prep

      Format:
      - Prioritized action list (Action | Deal | Why now | Expected outcome)
      - Time estimate per action

# ============================================================================
# STAKEHOLDER INTELLIGENCE PROMPTS
# ============================================================================
stakeholder_intelligence:

  relationship_map:
    name: "Stakeholder Relationship Analysis"
    description: "Map stakeholder dynamics and influence"
    prompt: |
      Context: Review all interactions with {account_name} stakeholders
      in the last {time_period}.

      Action: Map the decision-making unit:
      - Who are the key players?
      - What is each person's sentiment toward {vendor}?
      - Who influences whom?
      - Who is missing from our conversations?

      Format:
      - Stakeholder table (Name | Role | Influence | Sentiment | Last contact)
      - Relationship gaps (who we need to reach)
      - Power dynamics summary
      - Recommended engagement sequence

  champion_health:
    name: "Champion Health Check"
    description: "Assess strength of our internal champion"
    prompt: |
      Context: {champion_name} is our primary champion at {account_name}.
      Review all their interactions and signals.

      Action: Assess champion effectiveness:
      - Are they actively selling internally?
      - Do they have budget authority or influence?
      - Are they responsive and engaged?
      - Any signs of weakening support?

      Format:
      - Champion strength score (1-10)
      - Evidence for score
      - Risks to champion relationship
      - Actions to strengthen or backup champion

  executive_brief:
    name: "Executive Meeting Preparation"
    description: "Prepare for executive-level customer meeting"
    prompt: |
      Context: Upcoming meeting with {executive_name} ({title}) at {account_name}.
      Review account history, recent news, and previous executive interactions.

      Action: Prepare executive briefing:
      - What does this executive care about?
      - What value have we delivered?
      - What are we asking for?
      - What objections might arise?

      Format:
      - Executive profile (priorities, communication style)
      - Key talking points (3-5 max)
      - Value delivered summary
      - Ask/next step recommendation
      - Objection responses

# ============================================================================
# COMMERCIAL SIGNAL PROMPTS
# ============================================================================
commercial_signals:

  budget_signal_scan:
    name: "Budget Signal Detection"
    description: "Identify budget-related signals in communications"
    prompt: |
      Context: Scan all communications with {account_name} in the last
      {time_period}.

      Action: Extract any mentions of:
      - Budget availability or constraints
      - Fiscal year timing
      - Approval processes
      - Competing priorities for budget

      Format:
      - Budget signals table (Date | Source | Signal | Implication)
      - Budget health assessment
      - Recommended budget-securing actions

  competitive_threat:
    name: "Competitive Threat Assessment"
    description: "Identify competitive activity in account"
    prompt: |
      Context: Review all mentions of competitors in {account_name}
      communications.

      Action: Assess competitive threat level:
      - Which competitors are active?
      - What are they offering?
      - How is customer responding?
      - Where are we winning/losing?

      Format:
      - Competitor activity table (Competitor | Activity | Threat level)
      - Our competitive position summary
      - Differentiation points to emphasize
      - Defensive actions needed

  expansion_opportunity:
    name: "Expansion Signal Detection"
    description: "Identify upsell and cross-sell opportunities"
    prompt: |
      Context: Review {account_name} usage patterns, conversations, and
      business context.

      Action: Identify expansion opportunities:
      - New use cases mentioned
      - New departments or teams
      - Increased usage signals
      - Business growth indicators

      Format:
      - Expansion opportunities table (Opportunity | Signal | Value estimate)
      - Prioritized pursuit order
      - Stakeholders to engage for each
      - Recommended approach

# ============================================================================
# MEETING PREPARATION PROMPTS
# ============================================================================
meeting_prep:

  call_prep:
    name: "Customer Call Preparation"
    description: "Prepare for upcoming customer call"
    prompt: |
      Context: Upcoming call with {account_name} on {date}.
      Attendees: {attendees}. Purpose: {meeting_purpose}.

      Action: Prepare call brief:
      - What happened in last interaction?
      - What are open items/commitments?
      - What should we accomplish in this call?
      - What risks need addressing?

      Format:
      - Last interaction summary
      - Open items checklist
      - Objectives for this call (max 3)
      - Questions to ask
      - Risks to address proactively

  qbr_prep:
    name: "QBR Preparation"
    description: "Prepare Quarterly Business Review materials"
    prompt: |
      Context: Prepare QBR for {account_name}.
      ARR: {arr}. Relationship length: {years}.

      Action: Build QBR content:
      - Value delivered this quarter
      - Adoption metrics
      - Open issues and resolutions
      - Roadmap updates relevant to them
      - Expansion discussion points

      Format:
      - Executive summary (1 paragraph)
      - Value delivered (quantified where possible)
      - Health scorecard
      - Forward-looking discussion points
      - Ask/recommendation

  post_call_summary:
    name: "Post-Call Summary"
    description: "Summarize call and extract action items"
    prompt: |
      Context: Just completed call with {account_name}.
      Notes: {call_notes}

      Action: Create call summary:
      - Key discussion points
      - Decisions made
      - Commitments (ours and theirs)
      - Risks or concerns raised
      - Sentiment assessment

      Format:
      - 3-sentence executive summary
      - Decisions table (Decision | Who | Impact)
      - Action items (Action | Owner | Due date)
      - Follow-up required (YES/NO with what)
      - CRM update recommendations

# ============================================================================
# OPPORTUNITY HYGIENE PROMPTS
# Based on industry SA best practices
# ============================================================================
opportunity_hygiene:

  weekly_hygiene_check:
    name: "Weekly Opportunity Hygiene Check"
    description: "Perform weekly hygiene check on all active opportunities"
    prompt: |
      Context: Weekly hygiene review for {ae_name} opportunities.
      Current pipeline: {pipeline_summary}
      Date: {review_date}

      Action: Check hygiene for each opportunity:
      - Is stage accurate based on activity?
      - Is close date realistic?
      - Are next steps current?
      - When was last customer contact?
      - Is risk assessment current?
      - Are stakeholders still engaged?

      Format:
      - Hygiene checklist per opportunity:
        | Opportunity | Stage OK | Date OK | Next Steps | Last Contact | Risk Updated |
      - Opportunities needing immediate update
      - Stale opportunities (no activity >14 days)
      - Stage change recommendations
      - Close date adjustment recommendations

  opportunity_health_indicators:
    name: "Opportunity Health Indicator Assessment"
    description: "Assess health indicators for opportunity"
    prompt: |
      Context: Health assessment for {opportunity_name} at {account_name}.
      Current stage: {stage}
      Days in stage: {days_in_stage}
      Last customer contact: {last_contact_date}

      Action: Assess health indicators:
      - Evaluate all green/yellow/red criteria
      - Identify specific concerns
      - Recommend actions to improve health

      Format:
      - Health status: [GREEN|YELLOW|RED]
      - Health indicators assessment:

        GREEN criteria (all must be true):
        - [ ] Customer engaged in last 7 days
        - [ ] Next meeting scheduled
        - [ ] Champion active
        - [ ] No blocking issues

        YELLOW indicators (any trigger yellow):
        - [ ] No customer contact in 14 days
        - [ ] Decision maker not engaged
        - [ ] Competitive activity detected
        - [ ] Timeline slipping

        RED indicators (any trigger red):
        - [ ] No customer contact in 21+ days
        - [ ] Champion gone dark
        - [ ] Budget/priority changed
        - [ ] Competitor preferred

      - Current status by indicator
      - Actions to move to GREEN
      - Escalation recommendation (if RED)

  stale_opportunity_alert:
    name: "Stale Opportunity Alert"
    description: "Identify and alert on stale opportunities"
    prompt: |
      Context: Scanning for stale opportunities in {ae_name} pipeline.
      Current date: {current_date}

      Action: Identify stale opportunities:
      - No customer contact in 14+ days
      - No activity logged in 7+ days
      - Next steps not updated in 7+ days
      - Stage unchanged for >2x expected duration

      Format:
      - Stale opportunities table:
        | Opportunity | Days Since Contact | Days in Stage | Last Activity | Alert Level |
      - Alert level definitions:
        - WARNING: 14-21 days no contact
        - CRITICAL: 21+ days no contact
      - Recommended action per opportunity
      - Opportunities to potentially close-lost

  hygiene_report:
    name: "Weekly Hygiene Report"
    description: "Generate weekly hygiene report for AE/Manager"
    prompt: |
      Context: Weekly hygiene report for {ae_name}.
      Week ending: {week_end_date}
      Pipeline: {pipeline_summary}

      Action: Generate hygiene report:
      - Overall hygiene score
      - Opportunities by health status
      - Activity summary
      - Issues requiring attention

      Format:
      - Hygiene score: {percentage}%
      - Health distribution:
        - GREEN: {count} ({percentage}%)
        - YELLOW: {count} ({percentage}%)
        - RED: {count} ({percentage}%)
      - Activity metrics:
        - Opportunities updated this week: {count}
        - Customer meetings held: {count}
        - Deals advanced: {count}
      - Attention required:
        - Stale opportunities list
        - Hygiene violations list
      - Week-over-week comparison
      - Recommendations for next week

  crm_update_checklist:
    name: "CRM Update Checklist"
    description: "Generate CRM update checklist for opportunity"
    prompt: |
      Context: CRM update needed for {opportunity_name} at {account_name}.
      Recent activity: {recent_activity}
      Current CRM state: {crm_state}

      Action: Generate update checklist:
      - What fields need updating?
      - What activities need logging?
      - What notes should be added?

      Format:
      - Fields to update:
        - [ ] Stage: Current → Recommended
        - [ ] Close date: Current → Recommended
        - [ ] Amount: Current → Recommended if changed
        - [ ] Next steps: Update with {recommendation}
        - [ ] Forecast category: Current → Recommended
      - Activities to log:
        - {activity_list}
      - Notes to add:
        - {notes_content}
      - InfoHub updates needed:
        - {infohub_updates}

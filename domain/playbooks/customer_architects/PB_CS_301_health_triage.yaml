# PLAYBOOK: Health Triage
# Framework operationalization for AI agents
# Systematic response to customer health indicators

# ==============================================================================
# PLAYBOOK METADATA
# ==============================================================================
framework_name: "Health Triage"
framework_source: "Customer Success Best Practices"
playbook_mode: "ANALYTICAL"  # Analyzes health and recommends interventions
playbook_category: "relationship_governance"
intended_agent_role: "CA Agent (owns customer health)"
secondary_agents: ["Governance Agent", "AE Agent", "SA Agent", "Risk Radar Agent"]

primary_objective: "Systematically assess customer health indicators, identify root causes of decline, and execute targeted interventions to restore account health"

when_not_to_use:
  - "Account is in pre-sales stage"
  - "Customer has already churned"
  - "Account is in planned offboarding"
  - "Health decline is expected (planned migration, etc.)"

# ==============================================================================
# TRIGGER CONDITIONS
# ==============================================================================
trigger_conditions:
  automatic:
    - event: "SIG_HLT_001"
      description: "Health score alert triggered"
      timing: "Immediate"

    - event: "health_score_declined"
      signal_filter: "decline_percentage >= 10"
      description: "Health score dropped 10+ points"

    - event: "health_zone_change"
      signal_filter: "new_zone IN ['yellow', 'orange', 'red']"
      description: "Account moved to at-risk health zone"

    - event: "component_threshold_breach"
      description: "Individual health component below threshold"

    - event: "weekly_health_review"
      description: "Regular health portfolio review"
      timing: "Weekly"

  manual:
    - "CA identifies concerning health pattern"
    - "Executive requests health assessment"
    - "Renewal risk assessment"
    - "Customer escalation requires health context"

  conditional:
    - condition: "$.health_score.current < 70"
      description: "Health score below healthy threshold"

    - condition: "$.health_score.trend == 'declining' AND $.health_score.trend_duration_days >= 30"
      description: "Sustained health decline over 30 days"

    - condition: "$.health_components.engagement == 'red' OR $.health_components.adoption == 'red'"
      description: "Critical health component in red"

# ==============================================================================
# REQUIRED INPUTS
# ==============================================================================
validation_inputs:
  mandatory:
    - artifact: "{realm}/{node}/internal-infohub/governance/health_score.yaml"
      description: "Current health score and components"
    - artifact: "{realm}/{node}/external-infohub/overview.md"
      description: "Account context"

  optional:
    - artifact: "{realm}/{node}/external-infohub/success_plan/csp.yaml"
      use: "Success plan context"
    - artifact: "{realm}/{node}/external-infohub/success_plan/adoption_journey.yaml"
      use: "Adoption status"
    - artifact: "{realm}/{node}/internal-infohub/risks/risk_register.yaml"
      use: "Known risks"
    - artifact: "{realm}/{node}/internal-infohub/actions/action_tracker.yaml"
      use: "Open actions"
    - artifact: "{realm}/{node}/external-infohub/engagements/cadence_tracker.yaml"
      use: "Engagement history"
    - artifact: "/api/v1/realms/{realm}/nodes/{node}/usage-metrics"
      use: "Usage telemetry"
    - artifact: "/api/v1/realms/{realm}/nodes/{node}/support-tickets"
      use: "Support ticket history"

  minimum_data_threshold:
    - "Health score available"
    - "Basic account context available"

# ==============================================================================
# HEALTH ZONES
# ==============================================================================
health_zones:
  green:
    range: "80-100"
    name: "Healthy"
    description: "Account performing well, low risk"
    response:
      strategy: "Maintain and optimize"
      cadence_multiplier: 1.0
      focus: "Expansion opportunities, reference potential"
    actions:
      - "Continue standard cadence"
      - "Explore expansion opportunities"
      - "Document success for reference"

  yellow:
    range: "60-79"
    name: "Attention Needed"
    description: "Early warning signs, proactive intervention"
    response:
      strategy: "Proactive intervention"
      cadence_multiplier: 1.5
      focus: "Address declining components, prevent further decline"
    actions:
      - "Increase engagement frequency"
      - "Identify root causes"
      - "Create intervention plan"
      - "Monitor weekly"

  orange:
    range: "40-59"
    name: "At Risk"
    description: "Significant issues requiring active management"
    response:
      strategy: "Active recovery"
      cadence_multiplier: 2.0
      focus: "Recovery plan execution, executive engagement"
    actions:
      - "Execute recovery playbook"
      - "Daily/weekly monitoring"
      - "Executive engagement"
      - "Escalate blockers immediately"

  red:
    range: "0-39"
    name: "Critical"
    description: "Account in crisis, churn risk high"
    response:
      strategy: "Crisis management"
      cadence_multiplier: 3.0
      focus: "Retention, executive intervention, rapid response"
    actions:
      - "Immediate executive escalation"
      - "Daily engagement"
      - "All-hands recovery effort"
      - "Consider retention offers"

# ==============================================================================
# HEALTH COMPONENTS
# ==============================================================================
health_components:
  engagement:
    name: "Engagement Health"
    description: "Quality and frequency of customer interactions"
    indicators:
      positive:
        - "Regular cadence calls held"
        - "Executive participation in reviews"
        - "Proactive customer outreach"
        - "High response rate to communications"
      negative:
        - "Missed cadence calls"
        - "Low response to outreach"
        - "Champion disengagement"
        - "Executive unavailable"
    intervention_focus:
      - "Re-establish communication"
      - "Identify new champions"
      - "Adjust engagement format"
      - "Executive-to-executive outreach"

  adoption:
    name: "Adoption Health"
    description: "Depth and breadth of solution usage"
    indicators:
      positive:
        - "Usage metrics growing"
        - "New use cases adopted"
        - "Users active daily"
        - "Advanced features used"
      negative:
        - "Usage declining"
        - "Stalled at basic features"
        - "Low user counts"
        - "Decreasing login frequency"
    intervention_focus:
      - "Enablement sessions"
      - "Use case workshops"
      - "Training programs"
      - "Technical health check"

  outcomes:
    name: "Outcome Health"
    description: "Progress toward committed business outcomes"
    indicators:
      positive:
        - "Success criteria met"
        - "Metrics improving"
        - "Customer acknowledges value"
        - "Business outcomes documented"
      negative:
        - "Success criteria missed"
        - "Metrics declining"
        - "Value questioned"
        - "ROI not demonstrated"
    intervention_focus:
      - "Value realization session"
      - "Success criteria review"
      - "VE engagement"
      - "Outcome documentation"

  support:
    name: "Support Health"
    description: "Technical support experience"
    indicators:
      positive:
        - "Low ticket volume"
        - "Fast resolution times"
        - "High satisfaction scores"
        - "No escalations"
      negative:
        - "High ticket volume"
        - "Slow resolution"
        - "Escalations active"
        - "Repeated issues"
    intervention_focus:
      - "Technical review session"
      - "Support escalation"
      - "SA engagement"
      - "Architecture review"

  relationship:
    name: "Relationship Health"
    description: "Strength of stakeholder relationships"
    indicators:
      positive:
        - "Multiple champions"
        - "Executive access"
        - "Trust established"
        - "Partnership sentiment"
      negative:
        - "Champion departed"
        - "Executive unavailable"
        - "Trust eroding"
        - "Vendor sentiment"
    intervention_focus:
      - "Stakeholder remapping"
      - "New champion cultivation"
      - "Executive engagement"
      - "Relationship building activities"

  commercial:
    name: "Commercial Health"
    description: "Commercial relationship indicators"
    indicators:
      positive:
        - "Payment on time"
        - "Expansion discussions"
        - "Budget confirmed"
        - "Renewal confident"
      negative:
        - "Payment issues"
        - "Budget concerns"
        - "Competitive evaluation"
        - "Renewal uncertain"
    intervention_focus:
      - "AE engagement"
      - "Value reinforcement"
      - "Commercial review"
      - "Executive alignment"

# ==============================================================================
# KEY QUESTIONS
# ==============================================================================
key_questions:
  initial_assessment:
    - "What is the current health score and zone?"
    - "Which components are declining?"
    - "When did the decline start?"
    - "What triggered the change?"
    - "What interventions have been tried?"

  engagement_triage:
    - "When was the last meaningful customer interaction?"
    - "Who is our primary contact and are they engaged?"
    - "Has there been stakeholder turnover?"
    - "Are we reaching the right people?"

  adoption_triage:
    - "What does usage telemetry show?"
    - "Has there been organizational change affecting users?"
    - "Are there technical barriers to adoption?"
    - "What enablement gaps exist?"

  outcome_triage:
    - "Are we tracking against the right success criteria?"
    - "Has the customer's definition of success changed?"
    - "What value have we demonstrated?"
    - "Is the customer seeing ROI?"

  support_triage:
    - "Are there unresolved technical issues?"
    - "What is the customer's support experience?"
    - "Are issues being resolved to satisfaction?"
    - "Are there recurring problems?"

  root_cause_questions:
    - "Why is this health component declining?"
    - "What changed in the customer organization?"
    - "What did we miss or fail to execute?"
    - "Is this a one-time issue or systemic problem?"

# ==============================================================================
# DECISION LOGIC
# ==============================================================================
decision_logic:
  rules:
    # Zone-Based Response Rules
    - id: "yellow_zone_entry"
      condition: "health_zone == 'yellow' AND previous_zone == 'green'"
      severity: "MEDIUM"
      output_type: "Alert + Intervention Plan"
      decision:
        title: "Health declining for {node} - Yellow zone"
        context: "Account moved from Green to Yellow health zone"
        recommendation: "Execute proactive intervention"
        actions:
          - "Analyze declining components"
          - "Schedule additional touchpoint"
          - "Create 30-day intervention plan"
          - "Update CSP with concerns"
        stakeholders: ["CA"]

    - id: "orange_zone_entry"
      condition: "health_zone == 'orange'"
      severity: "HIGH"
      output_type: "Alert + Recovery Plan"
      decision:
        title: "Health critical for {node} - Orange zone"
        context: "Account in At Risk health zone"
        recommendation: "Execute active recovery playbook"
        actions:
          - "Immediate root cause analysis"
          - "Create recovery plan"
          - "Engage executive sponsor"
          - "Weekly progress tracking"
        urgency: "HIGH"
      creates:
        - object_type: "Risk"
          category: "health"
          severity: "HIGH"

    - id: "red_zone_entry"
      condition: "health_zone == 'red'"
      severity: "CRITICAL"
      output_type: "Escalation + Crisis Plan"
      decision:
        title: "CRITICAL: Health crisis for {node}"
        context: "Account in Critical health zone - immediate action required"
        recommendation: "Execute crisis management"
        actions:
          - "Immediate executive escalation"
          - "Daily status tracking"
          - "All available resources engaged"
          - "Retention strategy activated"
        urgency: "IMMEDIATE"
      creates:
        - object_type: "Risk"
          category: "retention"
          severity: "CRITICAL"

    # Component-Specific Rules
    - id: "engagement_decline"
      condition: "component.engagement.status == 'declining' AND component.engagement.score < 50"
      severity: "HIGH"
      output_type: "Alert + Action Items"
      decision:
        title: "Engagement crisis for {node}"
        context: "Customer engagement significantly declining"
        recommendation: "Re-establish customer connection"
        actions:
          - "Reach out through alternative channels"
          - "Check if champion still active"
          - "Engage AE for economic buyer contact"
          - "Consider executive outreach"

    - id: "adoption_stall"
      condition: "component.adoption.status == 'stalled' AND stage_age_days > 60"
      severity: "MEDIUM"
      output_type: "Assessment + Enablement Plan"
      decision:
        title: "Adoption stalled for {node}"
        context: "Usage metrics flat or declining for 60+ days"
        recommendation: "Execute adoption acceleration"
        actions:
          - "Technical health check"
          - "User interviews"
          - "Enablement session planning"
          - "SA engagement for technical barriers"

    - id: "outcome_miss"
      condition: "component.outcomes.success_criteria_met < 0.5 AND milestone_date_passed"
      severity: "HIGH"
      output_type: "Alert + Value Review"
      decision:
        title: "Outcome targets missed for {node}"
        context: "Less than half of success criteria met by milestone"
        recommendation: "Conduct value realization review"
        actions:
          - "Schedule value review session"
          - "Assess if criteria still relevant"
          - "Document partial value achieved"
          - "Reset expectations if needed"
        stakeholders: ["CA", "VE Agent"]

    - id: "support_escalation"
      condition: "component.support.open_escalations > 0 AND escalation_age_days > 7"
      severity: "HIGH"
      output_type: "Alert + Technical Focus"
      decision:
        title: "Unresolved support escalation for {node}"
        context: "Support escalation open for 7+ days"
        recommendation: "Focus on technical resolution"
        actions:
          - "Escalate internally"
          - "Daily status to customer"
          - "SA engagement"
          - "Executive awareness"

    - id: "champion_loss"
      condition: "component.relationship.champion_departed == true"
      severity: "HIGH"
      output_type: "Alert + Relationship Plan"
      decision:
        title: "Champion departure at {node}"
        context: "Key champion has left the organization"
        recommendation: "Immediate stakeholder remapping"
        actions:
          - "Identify new contacts"
          - "Map influence network"
          - "Establish new relationships"
          - "Assess knowledge transfer risk"
        urgency: "HIGH"

    # Recovery Rules
    - id: "health_improving"
      condition: "health_trend == 'improving' AND consecutive_improvements >= 4"
      severity: "LOW"
      output_type: "Status Update"
      decision:
        title: "Health improving for {node}"
        context: "Four consecutive weeks of health improvement"
        recommendation: "Continue current intervention, assess step-down"
        actions:
          - "Document what worked"
          - "Plan cadence normalization"
          - "Update success story"

    - id: "recovery_stalled"
      condition: "intervention_active AND days_since_intervention > 30 AND health_trend != 'improving'"
      severity: "HIGH"
      output_type: "Escalation"
      decision:
        title: "Recovery not working for {node}"
        context: "30 days of intervention without improvement"
        recommendation: "Escalate for strategy review"
        actions:
          - "Five Whys on intervention failure"
          - "Leadership review"
          - "Consider alternative approaches"
          - "Assess resource needs"

# ==============================================================================
# INTERVENTION PLAYBOOKS
# ==============================================================================
intervention_playbooks:
  engagement_recovery:
    name: "Re-Engage Disconnected Customer"
    trigger: "Engagement component red or declining"
    duration: "2-4 weeks"
    steps:
      - step: 1
        action: "Multi-channel outreach"
        owner: "CA"
        detail: "Email, phone, LinkedIn to all known contacts"
      - step: 2
        action: "AE engagement"
        owner: "AE"
        detail: "Contact economic buyer directly"
      - step: 3
        action: "Executive outreach"
        owner: "CA Manager"
        detail: "Executive-to-executive connection"
      - step: 4
        action: "Stakeholder remapping"
        owner: "CA"
        detail: "Identify new contacts and champions"

  adoption_acceleration:
    name: "Accelerate Stalled Adoption"
    trigger: "Adoption component declining or stalled"
    duration: "4-6 weeks"
    steps:
      - step: 1
        action: "Technical health check"
        owner: "SA"
        detail: "Assess technical barriers and issues"
      - step: 2
        action: "User interviews"
        owner: "CA"
        detail: "Understand adoption barriers from users"
      - step: 3
        action: "Enablement plan"
        owner: "CA/SA"
        detail: "Design targeted training program"
      - step: 4
        action: "Execute enablement"
        owner: "SA/Training"
        detail: "Deliver workshops and training"
      - step: 5
        action: "Monitor adoption"
        owner: "CA"
        detail: "Track usage metrics weekly"

  value_recovery:
    name: "Restore Value Perception"
    trigger: "Outcomes component red"
    duration: "4-8 weeks"
    steps:
      - step: 1
        action: "Value assessment"
        owner: "VE"
        detail: "Document actual value delivered"
      - step: 2
        action: "Success criteria review"
        owner: "CA/VE"
        detail: "Assess if criteria still relevant"
      - step: 3
        action: "Gap analysis"
        owner: "CA"
        detail: "Identify what's preventing value"
      - step: 4
        action: "Value presentation"
        owner: "VE/CA"
        detail: "Present value story to stakeholders"
      - step: 5
        action: "Reset expectations"
        owner: "CA"
        detail: "Agree new targets if needed"

  technical_crisis:
    name: "Resolve Technical Issues"
    trigger: "Support component red"
    duration: "1-4 weeks"
    steps:
      - step: 1
        action: "Issue assessment"
        owner: "SA"
        detail: "Understand all technical issues"
      - step: 2
        action: "Escalate appropriately"
        owner: "CA/SA"
        detail: "Engage support leadership"
      - step: 3
        action: "Daily updates"
        owner: "CA"
        detail: "Keep customer informed"
      - step: 4
        action: "Resolution and root cause"
        owner: "Support/SA"
        detail: "Fix issues and prevent recurrence"
      - step: 5
        action: "Goodwill gesture"
        owner: "CA"
        detail: "Consider compensation if appropriate"

# ==============================================================================
# EXPECTED OUTPUTS
# ==============================================================================
expected_outputs:
  primary_artifact:
    path: "{realm}/{node}/internal-infohub/governance/health_triage_{date}.md"
    format: "markdown"
    sections:
      - triage_summary
      - component_analysis
      - root_cause_assessment
      - intervention_plan
      - progress_tracking

    schema:
      triage_summary:
        - date: "date"
        - current_score: "integer"
        - previous_score: "integer"
        - health_zone: "enum[green|yellow|orange|red]"
        - zone_change: "boolean"
        - trigger: "string"

      component_analysis:
        type: "array"
        items:
          component: "string"
          score: "integer"
          status: "enum[healthy|declining|critical]"
          key_indicators: "array[string]"
          intervention_needed: "boolean"

      root_cause_assessment:
        - primary_cause: "string"
        - contributing_factors: "array[string]"
        - five_whys_applied: "boolean"
        - root_cause_controllable: "boolean"

      intervention_plan:
        - playbook_selected: "string"
        - duration: "string"
        - owner: "string"
        - steps: "array[step]"
        - target_health_score: "integer"
        - review_date: "date"

  risk_object:
    path: "{realm}/{node}/internal-infohub/risks/"
    create_if: "health_zone IN ['orange', 'red']"
    content:
      category: "health"
      severity: "Based on zone"
      description: "Health triage findings"
      mitigation: "Intervention plan"

  action_items:
    path: "{realm}/{node}/internal-infohub/actions/"
    create_for_each: "Intervention step"

  notifications:
    - recipient: "AE Agent"
      condition: "commercial_component_declining OR renewal_at_risk"
      message: "Commercial health concern at {node}"

    - recipient: "SA Agent"
      condition: "technical_component_declining OR support_escalation"
      message: "Technical health concern at {node}"

    - recipient: "Governance Agent"
      condition: "health_zone IN ['orange', 'red']"
      message: "Health triage completed for {node} - Zone: {zone}"

    - recipient: "CA Manager"
      condition: "health_zone == 'red'"
      message: "CRITICAL: {node} in red health zone"

# ==============================================================================
# STOP CONDITIONS
# ==============================================================================
stop_conditions:
  escalate_to_human:
    - condition: "health_zone == 'red'"
      reason: "Critical health requires human leadership"
      action: "CA Manager and leadership briefing"

    - condition: "intervention_failed_twice"
      reason: "Multiple intervention attempts unsuccessful"
      action: "Strategy review with leadership"

    - condition: "customer_threatening_churn"
      reason: "Customer explicitly stated churn intent"
      action: "Retention team engagement"

  insufficient_data:
    - "No health score available"
    - "Usage telemetry not accessible"
    - "Customer completely unresponsive"

  ambiguity_signals:
    - "Conflicting health indicators"
    - "Unclear root cause despite analysis"
    - "Customer providing inconsistent feedback"

# ==============================================================================
# VALIDATION CHECKS
# ==============================================================================
validation_checks:
  pre_execution:
    - "Health score data is current"
    - "Previous triage notes reviewed if any"
    - "Account context understood"

  post_execution:
    - "All declining components analyzed"
    - "Root cause identified or escalated"
    - "Intervention plan created if needed"
    - "Progress tracking established"
    - "Appropriate stakeholders notified"

  output_quality:
    - "Root cause analysis is specific, not generic"
    - "Intervention plan has clear owners and dates"
    - "Target health score is realistic"
    - "Review cadence appropriate to severity"

# ==============================================================================
# INTEGRATION WITH OTHER PLAYBOOKS
# ==============================================================================
integrates_with:
  - playbook: "PB_105_five_whys_analysis"
    integration: "Use for deep root cause analysis"
    trigger: "Root cause unclear after initial triage"

  - playbook: "PB_CS_202_cadence_calls"
    integration: "Adjust cadence based on health zone"
    trigger: "Zone change"

  - playbook: "PB_CS_303_renewal_protection"
    integration: "Health feeds renewal risk assessment"
    trigger: "Renewal approaching with health < 70"

  - playbook: "PB_CS_101_security_stage_adoption"
    integration: "Adoption issues may cause health decline"
    trigger: "Adoption component declining"

  - playbook: "PB_401_customer_health_score"
    integration: "Triage consumes health score output"
    trigger: "Health score update"

# ==============================================================================
# EXECUTION METADATA
# ==============================================================================
estimated_execution_time: "30-60 minutes per triage"
frequency: "On trigger or weekly review"
human_review_required: true
approval_workflow:
  - reviewer: "CA"
    approval_gate: "Validate triage findings and intervention plan"
  - reviewer: "CA Manager"
    condition: "health_zone IN ['orange', 'red']"
    approval_gate: "Approve recovery strategy"

last_updated: "2026-01-21"
version: "1.0"
status: "production_ready"
notes: "Core health management playbook - integrates with existing health score framework"

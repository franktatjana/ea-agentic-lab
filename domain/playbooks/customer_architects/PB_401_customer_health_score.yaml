# PLAYBOOK: Customer Health Score
# Framework operationalization for AI agents

# ==============================================================================
# PLAYBOOK METADATA
# ==============================================================================
framework_name: "Customer Health Score"
framework_source: "Gainsight / Customer Success Best Practices"
intended_agent_role: "CA Agent (Customer Architect) / AE Agent"
secondary_agents: ["SA Agent provides technical health signals", "AE Agent provides commercial health signals"]
playbook_mode: "ANALYTICAL"
playbook_category: "relationship_governance"

primary_objective: "Calculate composite health metric from product usage, relationship quality, and business outcomes to predict retention risk and prioritize intervention"

when_not_to_use:
  - "First 90 days of customer relationship (insufficient usage data)"
  - "Accounts without deployed production usage (no health signals)"
  - "One-time project engagements (health tracking not applicable)"
  - "Accounts in active churn (too late for health score, need recovery plan)"

# ==============================================================================
# TRIGGER CONDITIONS
# ==============================================================================
trigger_conditions:
  automatic:
    - "Monthly health score calculation (scheduled first day of month)"
    - "Quarterly business review preparation"
    - "Usage metric drops below threshold (logins, data ingestion, query volume)"
    - "Support case escalation or severity increase"
    - "Executive sponsor departure or champion change"
    - "Contract renewal date approaching (90 days, 60 days, 30 days)"

  manual:
    - "AE requests health assessment for account planning"
    - "CA requests health score for intervention prioritization"
    - "Sales leadership requests portfolio health review"

  conditional:
    - "IF usage_trend[last_30_days] < -20% THEN trigger"
    - "IF support_cases[severity=HIGH] >= 2 THEN trigger"
    - "IF days_until_renewal <= 90 THEN trigger"
    - "IF executive_sponsor_change_detected THEN trigger"

# ==============================================================================
# REQUIRED INPUTS
# ==============================================================================
required_inputs:
  mandatory:
    - artifact: "{realm}/{node}/external-infohub/overview.md"
    - artifact: "{realm}/{node}/external-infohub/installed_base.md"
    - artifact: "Usage metrics (logins, data volume, active users)"
    - artifact: "Contract details (ARR, renewal date, contract length)"

  optional:
    - artifact: "{realm}/{node}/internal-infohub/stakeholders/relationship_map.md"
      use: "Relationship health (champion strength, executive sponsorship)"
    - artifact: "Support case history"
      use: "Support health (case volume, severity, resolution time)"
    - artifact: "{realm}/{node}/internal-infohub/risks/*.md"
      use: "Risk profile (open risks affecting health)"
    - artifact: "Meeting frequency and attendance"
      use: "Engagement health (touchpoint frequency, stakeholder participation)"
    - artifact: "Expansion pipeline or opportunities"
      use: "Growth signal (expansion interest indicates health)"

  minimum_data_threshold:
    - "At least 30 days of usage data"
    - "Confirmed ARR and renewal date"

# ==============================================================================
# KEY QUESTIONS TO EXTRACT
# ==============================================================================
key_questions:
  product_usage_health:
    - "What is login frequency trend (increasing, stable, decreasing)?"
    - "What is data ingestion volume trend (GB/day or events/day)?"
    - "What is query volume or search request trend?"
    - "What is active user count trend?"
    - "Are all deployed products actively used, or are some dormant?"
    - "What is feature adoption rate (new capabilities used vs. ignored)?"
    - "What is usage compared to contracted capacity (under-utilized vs. at-capacity)?"

  relationship_health:
    - "Is there an active executive sponsor at VP/C-level?"
    - "Is there a champion who advocates for {vendor} internally?"
    - "What is meeting frequency with customer stakeholders (weekly, monthly, quarterly, none)?"
    - "What is stakeholder engagement quality (proactive participation vs. passive)?"
    - "Have key stakeholders changed recently (champion departed, reorg)?"
    - "What is sentiment in recent interactions (positive, neutral, negative)?"

  support_and_delivery_health:
    - "How many support cases opened in last 90 days (by severity)?"
    - "What is average resolution time compared to SLA?"
    - "Are there recurring issues indicating unresolved technical problems?"
    - "What is customer satisfaction with support (CSAT scores if available)?"
    - "Are there open escalations or unresolved critical issues?"

  business_outcome_health:
    - "Has customer achieved stated business objectives (use case success)?"
    - "Is customer realizing documented value (ROI, performance improvements)?"
    - "Is customer expanding usage (new use cases, new teams, new regions)?"
    - "Is there expansion pipeline or expressed interest in additional capabilities?"
    - "Has customer provided references, case studies, or testimonials?"

  risk_indicators:
    - "Are there open HIGH severity risks in risk register?"
    - "Is budget or procurement pressure mentioned?"
    - "Is competitive evaluation or RFP in progress?"
    - "Are there organizational changes (layoffs, budget cuts, leadership turnover)?"
    - "Is contract up for renewal with expressed concerns?"

# ==============================================================================
# DECISION LOGIC
# ==============================================================================
decision_logic:
  rules:
    # Critical health (red) - immediate intervention
    - condition: "health_score < 50 OR health_category == RED"
      severity: "HIGH"
      output_type: "Risk + Initiative"
      decision: |
        CREATE Risk:
          title: "Account health critical for {node}"
          severity: "HIGH"
          category: "retention"
          description: "Health score {score}/100 indicates high churn risk"
          contributing_factors: [list health dimensions in RED]

        CREATE Initiative:
          title: "Customer health intervention for {node}"
          owner: "AE / CA Agent"
          urgency: "IMMEDIATE"
          actions:
            - "Schedule executive sponsor meeting within 7 days"
            - "Conduct health assessment workshop with customer"
            - "Engage specialist if technical issues driving poor health"
            - "Create recovery plan with specific milestones"
            - "Escalate to Sales Leadership and Customer Success Leadership"

    # At-risk health (yellow) - proactive outreach
    - condition: "health_score >= 50 AND health_score < 70 OR health_category == YELLOW"
      severity: "MEDIUM"
      output_type: "Initiative"
      decision: |
        CREATE Initiative:
          title: "Proactive health improvement for {node}"
          owner: "CA Agent / AE"
          urgency: "HIGH"
          actions:
            - "Increase touchpoint frequency (weekly check-ins)"
            - "Address specific health dimensions in YELLOW (usage, relationship, support)"
            - "Schedule QBR if not held in last 90 days"
            - "Identify quick wins to improve perception"
            - "Monitor closely for further deterioration"

    # Healthy (green) - maintain and expand
    - condition: "health_score >= 70 OR health_category == GREEN"
      output_type: "Decision"
      decision: |
        CREATE Decision:
          title: "Healthy account {node} - focus on expansion"
          context: "Health score {score}/100, all key dimensions healthy"
          decision: "Maintain engagement cadence, pursue expansion opportunities"
          actions:
            - "Continue quarterly business reviews"
            - "Explore expansion opportunities (H2 from Three Horizons)"
            - "Request customer reference or case study"
            - "Propose executive briefing on roadmap and innovation"

    # Usage declining trend (even if currently healthy)
    - condition: "usage_trend[last_30_days] < -15%"
      severity: "MEDIUM"
      output_type: "Risk + Initiative"
      decision: |
        CREATE Risk:
          title: "Usage decline detected for {node}"
          severity: "MEDIUM"
          category: "adoption"
          description: "Usage metrics down {percentage}% in last 30 days"

        CREATE Initiative:
          title: "Investigate usage decline for {node}"
          actions:
            - "CA Agent to review usage patterns and identify causes"
            - "Schedule meeting with customer to discuss usage trends"
            - "Check for project completion, seasonal patterns, or technical issues"
            - "Provide recommendations to increase adoption"

    # Renewal approaching with yellow/red health
    - condition: "days_until_renewal <= 90 AND health_score < 70"
      severity: "HIGH"
      output_type: "Risk + Initiative"
      decision: |
        CREATE Risk:
          title: "Renewal risk for {node}"
          severity: "HIGH"
          category: "renewal"
          description: "Contract renews in {days} days with health score {score}/100"

        CREATE Initiative:
          title: "Renewal risk mitigation for {node}"
          urgency: "IMMEDIATE"
          actions:
            - "Executive sponsor engagement"
            - "Value realization review (ROI achieved vs. projected)"
            - "Address all open risks and support issues"
            - "Prepare renewal business case with value narrative"
            - "Offer success planning session for post-renewal"

# ==============================================================================
# EXPECTED OUTPUTS
# ==============================================================================
expected_outputs:
  primary_artifact:
    path: "{realm}/{node}/internal-infohub/governance_health_score_{YYYY-MM-DD}.md"
    format: "markdown"
    sections:
      - executive_summary
      - overall_health_score
      - health_dimension_breakdown
      - trend_analysis
      - contributing_factors
      - recommendations

    schema:
      overall_health_score:
        score: "number (0-100)"
        category: "enum[GREEN|YELLOW|RED]"
        trend: "enum[IMPROVING|STABLE|DECLINING]"
        previous_score: "number|null (for comparison)"
        change: "number (delta from previous score)"

      health_dimensions:
        product_usage:
          score: "number (0-100)"
          status: "enum[GREEN|YELLOW|RED]"
          metrics:
            - login_frequency_30d: "number"
            - data_volume_trend: "enum[UP|STABLE|DOWN]"
            - active_users: "number"
            - feature_adoption_rate: "number (percentage)"
          weight: "number (0-1, sums to 1 across dimensions)"

        relationship_quality:
          score: "number (0-100)"
          status: "enum[GREEN|YELLOW|RED]"
          metrics:
            - executive_sponsor: "boolean"
            - champion_strength: "enum[STRONG|MODERATE|WEAK|NONE]"
            - meeting_frequency: "enum[WEEKLY|MONTHLY|QUARTERLY|RARE]"
            - sentiment: "enum[POSITIVE|NEUTRAL|NEGATIVE]"
          weight: "number"

        support_health:
          score: "number (0-100)"
          status: "enum[GREEN|YELLOW|RED]"
          metrics:
            - open_cases_high_severity: "number"
            - avg_resolution_time_vs_sla: "number (percentage)"
            - escalations_last_90d: "number"
          weight: "number"

        business_outcomes:
          score: "number (0-100)"
          status: "enum[GREEN|YELLOW|RED]"
          metrics:
            - objectives_achieved: "number (count or percentage)"
            - roi_realized: "enum[EXCEEDED|MET|BELOW_TARGET|UNKNOWN]"
            - expansion_interest: "boolean"
          weight: "number"

      trend_analysis:
        - period: "string (e.g., 'Last 90 days')"
          direction: "enum[IMPROVING|STABLE|DECLINING]"
          key_changes: "array[string]"

      contributing_factors:
        positive: "array[string] (factors improving health)"
        negative: "array[string] (factors degrading health)"

      recommendations:
        - priority: "enum[HIGH|MEDIUM|LOW]"
          action: "string"
          owner: "string (AE, CA Agent, SA Agent, Specialist)"
          timeline: "string"

  decision_objects:
    path: "{realm}/{node}/external-infohub/decisions/"
    create_if:
      - "Health score RED or YELLOW with renewal approaching"
      - "Intervention strategy selected (executive engagement, recovery plan)"
    template: "ADR format"

  risk_objects:
    path: "{realm}/{node}/internal-infohub/risks/"
    create_if:
      - "Health score RED (critical churn risk)"
      - "Health score YELLOW with renewal <90 days"
      - "Usage declining trend detected"
    template: "Risk with mitigation plan"

  initiative_objects:
    path: "{realm}/{node}/internal-infohub/initiatives/"
    create_if:
      - "Health intervention required"
      - "Proactive health improvement needed"
      - "Usage investigation required"
    template: "Initiative with actions, owner, timeline"

  dashboard_update:
    path: "{realm}/{node}/internal-infohub/governance/dashboards/portfolio_health.md"
    action: "Update account health score in portfolio dashboard"

  notifications:
    - recipient: "Account Executive"
      condition: "always"
      message: "Health score calculated for {node}: {score}/100 ({category})"

    - recipient: "CA Agent"
      condition: "health_category == YELLOW OR RED"
      message: "Health score {category} for {node} - intervention recommended"

    - recipient: "Sales Leadership"
      condition: "health_category == RED"
      message: "CRITICAL: Account health RED for {node} - churn risk"

    - recipient: "Customer Success Leadership"
      condition: "health_category == RED OR (health_category == YELLOW AND days_until_renewal <= 90)"
      message: "Escalation: {node} health {category} with renewal in {days} days"

# ==============================================================================
# STOP CONDITIONS
# ==============================================================================
stop_conditions:
  escalate_to_human:
    - condition: "insufficient_usage_data (less than 30 days)"
      reason: "Cannot calculate reliable health score without sufficient data"
      action: "Wait for more usage data, manually assess health based on qualitative signals"

    - condition: "contradictory_signals (e.g., high usage but champion departed)"
      reason: "Mixed signals require human interpretation of overall health"
      action: "CA Agent or AE to conduct qualitative health assessment"

    - condition: "health_score_red_with_renewal_imminent (score <50, renewal <30 days)"
      reason: "Critical situation requires immediate executive intervention"
      action: "Escalate to Sales Leadership and Customer Success VP immediately"

  insufficient_data:
    - "No usage metrics available (customer not instrumented)"
    - "No contract details (ARR, renewal date unknown)"
    - "No stakeholder relationship data (no relationship map)"

  ambiguity_signals:
    - "Usage data incomplete or sporadic"
    - "Conflicting health signals (strong usage but negative sentiment)"
    - "Unclear whether low usage is problem or expected (e.g., seasonal use case)"

  human_judgment_required:
    - "Weighting health dimensions (adjust weights based on account context)"
    - "Interpreting qualitative signals (meeting sentiment, stakeholder feedback)"
    - "Determining intervention urgency (immediate vs. proactive vs. monitor)"
    - "Assessing strategic importance (high-value logo vs. standard account)"

# ==============================================================================
# VALIDATION CHECKS
# ==============================================================================
validation_checks:
  pre_execution:
    - "client_id exists in InfoHub"
    - "At least 30 days of customer relationship (or document as 'early stage')"
    - "Usage data source available"

  post_execution:
    - "Overall health score between 0-100"
    - "Health category assigned (GREEN|YELLOW|RED)"
    - "All dimension scores between 0-100"
    - "Dimension weights sum to 1.0"
    - "At least 1 recommendation provided"

  output_quality:
    - "No vague health assessments ('seems okay' â†’ quantify with score)"
    - "All metrics cite source (usage API, meeting notes, support system)"
    - "Trend analysis compares to previous period (not absolute assessment)"
    - "Recommendations are actionable (not 'improve relationship')"

# ==============================================================================
# HEALTH SCORE CALCULATION
# ==============================================================================
calculation_formula:
  overall_score: "Weighted average of dimension scores"
  example:
    - "Product Usage (40% weight): 75/100"
    - "Relationship Quality (30% weight): 60/100"
    - "Support Health (15% weight): 80/100"
    - "Business Outcomes (15% weight): 70/100"
    - "Overall: (75*0.4) + (60*0.3) + (80*0.15) + (70*0.15) = 30 + 18 + 12 + 10.5 = 70.5"

  category_thresholds:
    - "GREEN: 70-100"
    - "YELLOW: 50-69"
    - "RED: 0-49"

  dimension_scoring_guidelines:
    product_usage:
      - "90-100: High engagement, increasing usage, full feature adoption"
      - "70-89: Moderate engagement, stable usage"
      - "50-69: Low engagement, declining usage, limited feature adoption"
      - "0-49: Minimal engagement, significant usage decline, dormant products"

    relationship_quality:
      - "90-100: Executive sponsor + strong champion, frequent proactive engagement, positive sentiment"
      - "70-89: Champion present, regular engagement, neutral-to-positive sentiment"
      - "50-69: Weak champion, infrequent engagement, neutral sentiment"
      - "0-49: No champion, rare engagement, negative sentiment, stakeholder churn"

    support_health:
      - "90-100: Few cases, fast resolution, no escalations"
      - "70-89: Moderate cases, within SLA, occasional escalations"
      - "50-69: High case volume, SLA misses, recurring issues"
      - "0-49: Critical escalations, unresolved issues, support dissatisfaction"

    business_outcomes:
      - "90-100: Objectives exceeded, ROI validated, expansion initiated"
      - "70-89: Objectives met, ROI on track"
      - "50-69: Objectives partially met, ROI unclear"
      - "0-49: Objectives not met, value not realized"

# ==============================================================================
# EXECUTION METADATA
# ==============================================================================
estimated_execution_time: "3-5 minutes (agent) + 10-15 minutes (human review)"
frequency: "Monthly (scheduled) + triggered by events"
human_review_required: true
approval_workflow:
  - reviewer: "CA Agent / AE"
    approval_gate: "Validate health score accuracy, dimension assessments, recommendations"
  - reviewer: "Sales Leadership"
    condition: "health_category == RED"
    approval_gate: "Approve intervention strategy and resource allocation"

last_updated: "2026-01-11"
version: "1.0"
status: "production_ready"

# RAG System Design Playbook

id: "PB_SRCH_008"
name: "RAG System Design"
version: "1.0"
status: "ACTIVE"

metadata:
  category: "technical"
  framework: "RAG Architecture"
  team_owner: "specialists"
  specialty: "search"
  description: "Design Retrieval Augmented Generation systems for GenAI applications"

raci:
  responsible:
    role: "search_specialist"
    agent: "search_specialist_agent"
  accountable:
    role: "sa_lead"
    human_required: true
  consulted:
    - role: "solution_architects"
    - role: "ai_ml_team"
  informed:
    - role: "account_executives"
    - role: "product_management"

triggers:
  - event: "rag_design_requested"
  - event: "genai_project_with_search"
  - event: "knowledge_base_qa"

inputs:
  required:
    - name: "application_type"
      type: "string"
    - name: "corpus_description"
      type: "object"
    - name: "llm_constraints"
      type: "object"
  optional:
    - name: "accuracy_requirements"
    - name: "latency_requirements"
    - name: "cost_constraints"

steps:
  - step_id: "understand_application"
    name: "Understand RAG Application"
    outputs: ["application_analysis"]
    rag_patterns:
      - "Question answering over documents"
      - "Conversational AI with knowledge"
      - "Content generation with citations"
      - "Code assistant with documentation"
      - "Customer support automation"

  - step_id: "design_chunking"
    name: "Design Chunking Strategy"
    outputs: ["chunking_strategy"]
    chunking_considerations:
      - "Chunk size (tokens)"
      - "Overlap strategy"
      - "Boundary detection (semantic, structural)"
      - "Metadata preservation"
      - "Multi-level chunking"

  - step_id: "design_embedding"
    name: "Design Embedding Pipeline"
    outputs: ["embedding_pipeline"]
    pipeline_elements:
      - "Embedding model selection"
      - "Batch processing strategy"
      - "Incremental updates"
      - "Multi-vector approaches (hypothetical questions, summaries)"

  - step_id: "design_retrieval"
    name: "Design Retrieval Strategy"
    outputs: ["retrieval_strategy"]
    retrieval_approaches:
      - "Dense retrieval (vector similarity)"
      - "Sparse retrieval (BM25)"
      - "Hybrid retrieval"
      - "Multi-query retrieval"
      - "Iterative retrieval"

  - step_id: "design_reranking"
    name: "Design Re-ranking"
    outputs: ["reranking_strategy"]
    reranking_options:
      - "Cross-encoder re-ranking"
      - "LLM-based re-ranking"
      - "Reciprocal Rank Fusion"
      - "Diversity re-ranking"

  - step_id: "design_context_assembly"
    name: "Design Context Assembly"
    outputs: ["context_strategy"]
    context_considerations:
      - "Context window utilization"
      - "Chunk ordering"
      - "Source attribution"
      - "Context compression"

  - step_id: "design_grounding"
    name: "Design Grounding Strategy"
    outputs: ["grounding_strategy"]
    grounding_techniques:
      - "Citation injection"
      - "Confidence scoring"
      - "Fact verification"
      - "Hallucination detection"

  - step_id: "design_evaluation"
    name: "Design Evaluation Framework"
    outputs: ["evaluation_framework"]
    evaluation_dimensions:
      - "Retrieval quality (recall, precision)"
      - "Answer accuracy"
      - "Groundedness"
      - "Answer completeness"
      - "Latency"

  - step_id: "document_architecture"
    name: "Document RAG Architecture"
    outputs: ["rag_architecture_doc"]

outputs:
  format: "markdown"
  storage_path: "{realm}/{node}/external-infohub/specialists/search/rag_design_{date}.md"
  sections:
    - "Executive Summary"
    - "Application Analysis"
    - name: "Data Pipeline Design"
      subsections:
        - "Chunking Strategy"
        - "Embedding Pipeline"
    - name: "Retrieval Design"
      subsections:
        - "Retrieval Strategy"
        - "Re-ranking Approach"
    - name: "Generation Integration"
      subsections:
        - "Context Assembly"
        - "Grounding Strategy"
    - "Evaluation Framework"
    - "Architecture Diagram"
    - "Implementation Roadmap"

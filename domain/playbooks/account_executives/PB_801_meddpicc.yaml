# PLAYBOOK: MEDDPICC Sales Qualification Framework
# Commercial qualification framework for strategic deals
# Version 1.0 - PLAYBOOK_EXECUTION_SPECIFICATION standard

# ==============================================================================
# PLAYBOOK STECKBRIEF
# ==============================================================================
steckbrief:
  playbook_id: "PB_801"
  name: "MEDDPICC"
  category: "account_executives"
  mode: "ASSESSMENT"
  version: "1.0"
  status: "production_ready"

  one_liner: "Qualify opportunity using MEDDPICC methodology to assess deal health, identify gaps, and determine win probability"
  framework_origin: "PTC/Jack Napoli (Parametric Technology Corporation)"

  owner_agent: "AE Agent"
  supporting_agents: ["SA Agent", "VE Agent", "POC Agent"]

  triggers_summary:
    - "Opportunity moves to Stage 2 or deal being added to forecast commit"
    - "Weekly deal review, pipeline review, or large deal threshold ($250K+ ARR)"
    - "Stage 2+ opportunity over $100K, or close date in 90 days without recent assessment"

  anti_patterns:
    - "Opportunity ARR < $50K (use simplified qualification)"
    - "Renewal-only with no expansion (use health score instead)"
    - "Customer in active churn process (use retention playbook)"
    - "Initial discovery not yet completed"

  key_inputs:
    - "Discovery findings from customer conversations"
    - "Key contacts and relationships (stakeholder map)"
    - "SFDC opportunity record with ARR, stage, close date"

  key_outputs:
    - artifact: "MEDDPICC Assessment Scorecard"
      format: "yaml"
    - artifact: "Gap Analysis with Action Plan"
      format: "yaml"
    - artifact: "Risk Objects (commercial risks, relationship risks)"
      format: "yaml"

  key_decisions:
    - "No Economic Buyer identified: block stage advancement until EB engaged"
    - "No Champion or weak champion: develop champion or find alternate path"
    - "Deal health critical (score < 50%): reassess forecast commitment"
    - "Well-qualified deal (score >= 75%): maintain momentum, focus on closing"

  complexity: "HIGH"
  estimated_inputs: 10
  estimated_rules: 6

  source_file: "domain/playbooks/account_executives/PB_801_meddpicc.yaml"
  last_updated: "2026-01-20"

# ==============================================================================
# PLAYBOOK METADATA
# ==============================================================================
framework_name: "MEDDPICC"
framework_source: "PTC/Jack Napoli (Parametric Technology Corporation)"
playbook_mode: "ASSESSMENT"
playbook_category: "pursuit_sales_support"
intended_agent_role: "AE Agent"
secondary_agents: ["SA Agent", "VE Agent", "POC Agent"]

primary_objective: "Qualify opportunity using MEDDPICC methodology to assess deal health, identify gaps, and determine win probability"

when_not_to_use:
  - "Opportunity ARR < $50K (use simplified qualification)"
  - "Renewal-only opportunity with no expansion (use health score instead)"
  - "Customer in active churn process (use retention playbook)"
  - "Initial discovery not yet completed"

# ==============================================================================
# TRIGGER CONDITIONS
# ==============================================================================
trigger_conditions:
  automatic:
    - event: "opportunity_stage_2"
      description: "Opportunity moves to Stage 2 (Qualification)"

    - event: "forecast_commit_requested"
      description: "Deal being added to forecast commit"

    - event: "deal_review_scheduled"
      description: "Weekly deal review or pipeline review scheduled"

    - event: "large_deal_threshold"
      description: "Opportunity exceeds $250K ARR"
      condition: "$.opportunity.arr >= 250000"

  manual:
    - "AE requests qualification assessment"
    - "Sales leadership requests deal review"
    - "Pre-QBR qualification check"

  conditional:
    - condition: "$.opportunity.stage >= 2 AND $.opportunity.arr >= 100000"
      description: "Stage 2+ opportunity over $100K requires MEDDPICC"

    - condition: "$.opportunity.close_date <= 90_days AND $.meddpicc.last_assessed > 30_days"
      description: "Deal closing soon but MEDDPICC not recently assessed"

# ==============================================================================
# REQUIRED INPUTS
# ==============================================================================
validation_inputs:
  mandatory:
    - artifact: "{account}/external-infohub/opportunities/{opportunity}/discovery.yaml"
      description: "Discovery findings from customer conversations"
    - artifact: "{account}/external-infohub/context/stakeholder_map.yaml"
      description: "Key contacts and relationships"
    - artifact: "Opportunity record"
      description: "SFDC opportunity with ARR, stage, close date"

  optional:
    - artifact: "{account}/external-infohub/opportunities/{opportunity}/requirements.yaml"
      use: "Understand decision criteria"
    - artifact: "{account}/internal-infohub/competitive/competitive_context.yaml"
      use: "Assess competitive landscape"
    - artifact: "Meeting notes"
      use: "Extract champion signals and pain points"
    - artifact: "Value hypothesis"
      use: "Link metrics to business outcomes"
    # Tech Radar inputs for MEDDPICC
    - artifact: "{realm}/intelligence/tech_radar/current_radar.yaml"
      use: "Understand customer's technology investment priorities"
    - artifact: "/api/v1/realms/{realm}/tech-radar/hiring-velocity"
      use: "Hiring trends indicate IT investment levels and economic buyer priorities"
    - artifact: "/api/v1/realms/{realm}/tech-radar/skills-gap"
      use: "Identify metrics around technologies customer is investing in"

  minimum_data_threshold:
    - "Economic buyer identified or discovery planned"
    - "At least one pain point documented"
    - "Champion candidate identified"

# ==============================================================================
# KEY QUESTIONS TO EXTRACT (MEDDPICC Framework)
# ==============================================================================
key_questions:
  metrics:
    questions:
      - "What specific, quantified business outcomes will justify this purchase?"
      - "What KPIs or metrics will improve with our solution?"
      - "What is the cost of the current state (cost of inaction)?"
      - "What ROI or payback period does the customer expect?"
      - "Have we co-developed a business case with the customer?"
      # Tech Radar driven metrics questions
      - "What technology investments (from tech radar) indicate metrics priorities?"
      - "Is hiring velocity in related areas (DevSecOps, SRE) supporting metrics assumptions?"
      - "Can we tie our solution to technologies in their 'Adopt' ring?"
    evidence_required: ["ROI calculation", "business case", "customer quote on metrics"]

  economic_buyer:
    questions:
      - "Who has budget authority and will sign the contract?"
      - "Have we engaged directly with the economic buyer?"
      - "What are the economic buyer's personal priorities?"
      - "What other initiatives compete for their budget?"
      - "Is budget allocated, or does it need approval?"
      # Tech Radar driven EB questions
      - "What does hiring velocity tell us about IT investment levels?"
      - "Are senior roles (principal, executive) driving technology decisions we should align with?"
      - "What technologies in 'Adopt' ring indicate strategic investment areas?"
    evidence_required: ["Economic buyer name/title", "meeting notes with EB", "budget confirmation"]

  decision_criteria:
    questions:
      - "What criteria will they use to evaluate vendors?"
      - "What are must-have vs. nice-to-have requirements?"
      - "Have we influenced the decision criteria in our favor?"
      - "What criteria favor competitors?"
      - "Are there compliance or security requirements?"
    evidence_required: ["RFP/requirements doc", "customer stated criteria", "technical requirements"]

  decision_process:
    questions:
      - "What is the formal approval process to buy?"
      - "Who else needs to approve beyond the economic buyer?"
      - "What is the timeline for each approval step?"
      - "Are there committee reviews or board approvals needed?"
      - "Have we mapped the complete decision process?"
    evidence_required: ["Process map", "customer-confirmed timeline", "approval chain"]

  paper_process:
    questions:
      - "What is the legal and procurement process?"
      - "Are there standard contract terms or MSAs?"
      - "What legal or security reviews are required?"
      - "Who leads procurement negotiations?"
      - "What is the typical contract cycle time?"
    evidence_required: ["Procurement contact", "legal requirements", "contract timeline"]

  identify_pain:
    questions:
      - "What business problems are driving this initiative?"
      - "What happens if they don't solve these problems?"
      - "Is the pain acknowledged at the executive level?"
      - "Is this a 'must solve' or 'nice to have' problem?"
      - "What is the urgency to address the pain?"
    evidence_required: ["Pain statements from customer", "business impact", "urgency indicators"]

  champion:
    questions:
      - "Who inside the customer is actively selling for us?"
      - "Does the champion have power, influence, and access to the EB?"
      - "What is the champion's personal win in this deal?"
      - "Has the champion given us insider information?"
      - "Will the champion coach us on how to win?"
    evidence_required: ["Champion name", "evidence of advocacy", "insider information received"]

  competition:
    questions:
      - "Who else is being evaluated?"
      - "What is the customer's perception of each competitor?"
      - "Where do we win and lose vs. competition?"
      - "Is there an incumbent we need to displace?"
      - "What is our competitive strategy?"
    evidence_required: ["Competitor names", "competitive positioning", "win themes"]

# ==============================================================================
# DECISION LOGIC (DLL Syntax)
# ==============================================================================
decision_logic:
  scoring:
    # Each MEDDPICC element scored 0-3
    # 0 = Not identified, 1 = Partially identified, 2 = Validated, 3 = Verified/Tested
    max_score: 24
    green_threshold: 18  # 75%
    yellow_threshold: 12  # 50%
    red_threshold: 11     # Below 50%

  rules:
    - id: "no_economic_buyer"
      condition: "$.meddpicc.economic_buyer.score == 0"
      severity: "HIGH"
      output_type: "Risk + Action"
      decision:
        title: "No Economic Buyer Identified"
        context: "Cannot win a deal without knowing who signs the contract"
        recommendation: "Identify and engage economic buyer before advancing stage"
        actions:
          - "Ask champion to introduce us to economic buyer"
          - "Research org chart for budget holder"
          - "Do not advance to Stage 3 until EB engaged"
        owner: "Account Executive"
      creates:
        - object_type: "Risk"
          category: "commercial"
          severity: "HIGH"
        - object_type: "Action"
          urgency: "IMMEDIATE"

    - id: "no_champion"
      condition: "$.meddpicc.champion.score <= 1"
      severity: "HIGH"
      output_type: "Risk + Action"
      decision:
        title: "No Champion or Weak Champion"
        context: "Champion is critical to winning; someone must sell internally for us"
        recommendation: "Develop champion or find alternate path"
        actions:
          - "Identify potential champion candidates"
          - "Understand their personal win"
          - "Provide them with ammunition to sell internally"
        owner: "Account Executive"
      creates:
        - object_type: "Risk"
          category: "relationship"
          severity: "HIGH"

    - id: "no_compelling_pain"
      condition: "$.meddpicc.identify_pain.score <= 1"
      severity: "MEDIUM"
      output_type: "Risk"
      decision:
        title: "Pain Not Compelling or Not Executive-Level"
        context: "Without compelling pain, deals stall or lose to 'no decision'"
        recommendation: "Elevate pain to executive level, quantify business impact"
        actions:
          - "Use VE Agent to build business case"
          - "Find executive sponsor who owns the problem"
          - "Quantify cost of inaction"
        owner: "Account Executive + VE Agent"

    - id: "unknown_competition"
      condition: "$.meddpicc.competition.score == 0"
      severity: "MEDIUM"
      output_type: "Action"
      decision:
        title: "Competitive Landscape Unknown"
        context: "Cannot position effectively without knowing alternatives"
        recommendation: "Discover competitive situation"
        actions:
          - "Ask champion who else they are evaluating"
          - "Research customer's incumbent tools"
          - "Engage CI Agent for competitive intelligence"
        owner: "Account Executive + CI Agent"

    - id: "deal_at_risk"
      condition: "$.meddpicc.total_score < 12"
      severity: "HIGH"
      output_type: "Risk + Escalation"
      decision:
        title: "Deal Health Critical - MEDDPICC Score Below 50%"
        context: "Multiple qualification gaps indicate high loss probability"
        recommendation: "Reassess deal commitment, consider downgrade from forecast"
        actions:
          - "Review each MEDDPICC gap with sales leadership"
          - "Create action plan to address top 3 gaps"
          - "Consider removing from commit forecast until improved"
        escalate_to: "Sales Leadership"
      creates:
        - object_type: "Risk"
          category: "commercial"
          severity: "HIGH"

    - id: "well_qualified_deal"
      condition: "$.meddpicc.total_score >= 18"
      severity: "LOW"
      output_type: "Confidence"
      decision:
        title: "Well-Qualified Opportunity"
        context: "Strong MEDDPICC score indicates high win probability"
        recommendation: "Maintain momentum, focus on closing activities"
        actions:
          - "Proceed with POC/trial if needed"
          - "Begin paper process early"
          - "Confirm close plan with customer"

# ==============================================================================
# EXPECTED OUTPUTS
# ==============================================================================
validation_outputs:
  primary_artifact:
    path: "{account}/external-infohub/opportunities/{opportunity}/meddpicc_assessment_{YYYY-MM-DD}.yaml"
    format: "yaml"
    sections:
      - executive_summary
      - meddpicc_scorecard
      - gap_analysis
      - action_plan
      - risk_register

    schema:
      metrics:
        score: {type: "integer", min: 0, max: 3}
        status: {type: "string", enum: ["RED", "YELLOW", "GREEN"]}
        findings: {type: "string"}
        evidence: {type: "array"}
        gaps: {type: "array"}
        actions: {type: "array"}

      economic_buyer:
        score: {type: "integer", min: 0, max: 3}
        name: {type: "string", nullable: true}
        title: {type: "string", nullable: true}
        engaged: {type: "boolean"}
        status: {type: "string", enum: ["RED", "YELLOW", "GREEN"]}
        findings: {type: "string"}
        evidence: {type: "array"}

      decision_criteria:
        score: {type: "integer", min: 0, max: 3}
        criteria_list: {type: "array"}
        influenced: {type: "boolean"}
        status: {type: "string", enum: ["RED", "YELLOW", "GREEN"]}
        findings: {type: "string"}

      decision_process:
        score: {type: "integer", min: 0, max: 3}
        process_mapped: {type: "boolean"}
        approvers: {type: "array"}
        timeline: {type: "string"}
        status: {type: "string", enum: ["RED", "YELLOW", "GREEN"]}

      paper_process:
        score: {type: "integer", min: 0, max: 3}
        procurement_contact: {type: "string", nullable: true}
        legal_requirements: {type: "array"}
        estimated_cycle: {type: "string"}
        status: {type: "string", enum: ["RED", "YELLOW", "GREEN"]}

      identify_pain:
        score: {type: "integer", min: 0, max: 3}
        pain_points: {type: "array"}
        executive_acknowledged: {type: "boolean"}
        compelling: {type: "boolean"}
        status: {type: "string", enum: ["RED", "YELLOW", "GREEN"]}

      champion:
        score: {type: "integer", min: 0, max: 3}
        name: {type: "string", nullable: true}
        title: {type: "string", nullable: true}
        power: {type: "string", enum: ["HIGH", "MEDIUM", "LOW", "UNKNOWN"]}
        influence: {type: "string", enum: ["HIGH", "MEDIUM", "LOW", "UNKNOWN"]}
        access_to_eb: {type: "boolean"}
        personal_win: {type: "string", nullable: true}
        status: {type: "string", enum: ["RED", "YELLOW", "GREEN"]}

      competition:
        score: {type: "integer", min: 0, max: 3}
        competitors: {type: "array"}
        incumbent: {type: "string", nullable: true}
        our_position: {type: "string", enum: ["LEADING", "EVEN", "BEHIND", "UNKNOWN"]}
        status: {type: "string", enum: ["RED", "YELLOW", "GREEN"]}

      total_score:
        value: {type: "integer", min: 0, max: 24}
        percentage: {type: "number"}
        overall_status: {type: "string", enum: ["RED", "YELLOW", "GREEN"]}

  decision_objects:
    path: "{account}/external-infohub/decisions/"
    create_if:
      - "Forecast recommendation changes (commit/upside/pipeline)"
      - "Stage advancement blocked due to gaps"

  risk_objects:
    path: "{account}/internal-infohub/risks/"
    create_if:
      - "Critical MEDDPICC gap identified"
      - "Deal health score below threshold"

  action_objects:
    path: "{account}/internal-infohub/actions/"
    create_if:
      - "Gap requires specific next action"
      - "Escalation required"

# ==============================================================================
# STOP CONDITIONS
# ==============================================================================
stop_conditions:
  escalate_to_human:
    - condition: "$.meddpicc.total_score < 6"
      reason: "Deal fundamentally unqualified, needs AE judgment"
      action: "Recommend deal review with sales leadership"

    - condition: "$.opportunity.close_date < 30_days AND $.meddpicc.paper_process.score == 0"
      reason: "Close date imminent but no paper process started"
      action: "Alert AE to paper process risk"

    - condition: "$.meddpicc.economic_buyer.score == 0 AND $.opportunity.stage >= 3"
      reason: "Advanced stage without EB engagement"
      action: "Escalate to sales leadership - deal at risk"

  insufficient_data_signals:
    - "No discovery documented"
    - "No stakeholder map available"
    - "No meeting notes from customer interactions"

# ==============================================================================
# VALIDATION CHECKS
# ==============================================================================
validation_checks:
  pre_execution:
    - check: "$.opportunity.id EXISTS"
      description: "Opportunity must exist"
    - check: "$.opportunity.stage >= 1"
      description: "Opportunity must be at least Stage 1"

  post_execution:
    - check: "$.meddpicc.total_score IS_CALCULATED"
      description: "Total score must be calculated"
    - check: "$.meddpicc.*.evidence.length >= 1 WHERE $.meddpicc.*.score >= 2"
      description: "Scores of 2+ must have evidence"

  output_quality:
    - "All findings must cite evidence source"
    - "Actions must be specific and assignable"
    - "Competitor names must be verified, not assumed"

# ==============================================================================
# FRAMEWORK REFERENCE
# ==============================================================================
framework_reference:
  meddpicc_elements:
    metrics:
      definition: "Quantified business outcomes that justify the purchase"
      score_guide:
        0: "No metrics identified"
        1: "Generic metrics discussed"
        2: "Specific metrics agreed with customer"
        3: "Business case co-developed with ROI validated"

    economic_buyer:
      definition: "Person with budget authority who signs the contract"
      score_guide:
        0: "Not identified"
        1: "Identified but not engaged"
        2: "Engaged, supportive"
        3: "Committed, championing the deal"

    decision_criteria:
      definition: "Factors the customer will use to choose a vendor"
      score_guide:
        0: "Unknown"
        1: "General criteria known"
        2: "Detailed criteria documented"
        3: "Criteria influenced in our favor"

    decision_process:
      definition: "Steps and approvals required to make the purchase"
      score_guide:
        0: "Unknown"
        1: "High-level process known"
        2: "Detailed process mapped"
        3: "Process confirmed with timeline"

    paper_process:
      definition: "Legal, procurement, and contract process"
      score_guide:
        0: "Unknown"
        1: "General process known"
        2: "Procurement engaged, terms discussed"
        3: "Contract terms agreed, timeline confirmed"

    identify_pain:
      definition: "Business problems driving the purchase"
      score_guide:
        0: "No pain identified"
        1: "Technical pain identified"
        2: "Business pain with impact"
        3: "Executive-level pain with urgency"

    champion:
      definition: "Internal advocate selling for us"
      score_guide:
        0: "No champion"
        1: "Contact friendly but not advocating"
        2: "Champion identified, selling internally"
        3: "Power champion with access and influence"

    competition:
      definition: "Alternatives being evaluated"
      score_guide:
        0: "Unknown"
        1: "Competitors identified"
        2: "Competitive positioning known"
        3: "Winning strategy validated with champion"

# ==============================================================================
# EXECUTION METADATA
# ==============================================================================
last_updated: "2026-01-20"
version: "1.0"
status: "production_ready"
notes: "MEDDPICC qualification framework for AE Agent to assess deal health"

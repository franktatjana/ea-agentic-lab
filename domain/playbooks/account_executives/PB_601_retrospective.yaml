# PLAYBOOK: Deal Retrospective with Five Whys Analysis
# Framework operationalization for AI agents
# Combines structured retrospective with root cause analysis

# ==============================================================================
# PLAYBOOK METADATA
# ==============================================================================
framework_name: "Deal Retrospective with Five Whys"
framework_source: "Agile Retrospective + Toyota Five Whys"
playbook_mode: "ANALYTICAL"  # Analyzes completed deals for learnings
intended_agent_role: "Retrospective Agent (coordinates analysis)"
secondary_agents: ["AE Agent", "SA Agent", "CI Agent", "Governance Agent"]

primary_objective: "Conduct structured win/loss retrospective, identify root causes of outcomes, and generate actionable learnings for future deals"

when_not_to_use:
  - "Deal not yet closed"
  - "Insufficient data about deal history"
  - "Less than 7 days since close (allow emotions to settle)"
  - "Key participants unavailable for input"
  - "Confidential deal requiring special handling"

# ==============================================================================
# TRIGGER CONDITIONS
# ==============================================================================
trigger_conditions:
  automatic:
    - event: "SIG_COM_002"
      signal_filter: "outcome == 'won'"
      description: "Deal closed won - schedule win retrospective"
      timing: "within 7 days of close"

    - event: "SIG_COM_002"
      signal_filter: "outcome == 'lost'"
      description: "Deal closed lost - schedule loss retrospective"
      timing: "within 7 days of close"
      priority: "HIGH"

    - event: "no_decision_prolonged"
      description: "Deal stalled with no decision for 60+ days"
      condition: "$.deal.days_in_stage >= 60 AND $.deal.stage == 'no_decision'"

  manual:
    - "Sales leadership requests deal review"
    - "Account team requests structured retrospective"
    - "Pattern of similar outcomes needs analysis"

  conditional:
    - condition: "$.deal.value >= ${thresholds.strategic_deal_value}"
      description: "Strategic deal requires retrospective regardless of outcome"

    - condition: "$.deal.sales_cycle_days >= ${thresholds.long_sales_cycle}"
      description: "Extended sales cycle warrants learning capture"

# ==============================================================================
# REQUIRED INPUTS
# ==============================================================================
validation_inputs:
  mandatory:
    - artifact: "infohub/{realm}/{node}/overview.md"
      description: "Account overview"
    - artifact: "Deal outcome (won/lost)"
      description: "Final deal status"
    - artifact: "Sales cycle history"
      description: "Stage progression and key events"

  optional:
    - artifact: "infohub/{realm}/{node}/meetings/*.md"
      use: "Meeting notes from deal cycle"
    - artifact: "infohub/{realm}/{node}/competitive/*.md"
      use: "Competitive context"
    - artifact: "infohub/{realm}/{node}/stakeholders/relationship_map.md"
      use: "Stakeholder analysis"
    - artifact: "infohub/{realm}/{node}/decisions/*.md"
      use: "Decisions made during deal"
    - artifact: "POV/POC results"
      use: "Technical validation outcomes"
    - artifact: "Proposal and pricing"
      use: "Commercial positioning"
    - artifact: "infohub/{realm}/tech_signal_map/current_map.yaml"
      use: "Technology context"

  minimum_data_threshold:
    - "Deal outcome is known"
    - "Basic deal timeline available"
    - "At least one team member input available"

# ==============================================================================
# KEY QUESTIONS
# ==============================================================================
key_questions:
  deal_overview:
    - "What was the deal value and strategic importance?"
    - "How long was the sales cycle?"
    - "Who were the key stakeholders?"
    - "What competitors were involved?"
    - "What use cases were evaluated?"

  # FOR WINS
  win_analysis:
    - "What were the primary factors that won this deal?"
    - "Which value propositions resonated most strongly?"
    - "Who was our champion and how did they help?"
    - "What differentiated us from competitors?"
    - "What technical proof points were decisive?"
    - "What should we replicate in future deals?"

  # FOR LOSSES
  loss_analysis:
    - "What was the primary reason we lost?"
    - "When did we lose momentum in the deal?"
    - "What warning signs did we miss or ignore?"
    - "What did the competitor do better?"
    - "What stakeholders did we fail to engage?"
    - "What technical or commercial gaps hurt us?"

  # FIVE WHYS INTEGRATION
  five_whys_for_wins:
    purpose: "Understand why win factors succeeded to enable replication"
    - "Why did our value proposition resonate? (1st why)"
    - "Why were we able to deliver that value message? (2nd why)"
    - "Why did we have the right positioning/proof points? (3rd why)"
    - "Why were we prepared with that capability? (4th why)"
    - "What systematic advantage allowed this? (5th why - root success factor)"

  five_whys_for_losses:
    purpose: "Find root cause of loss to prevent recurrence"
    - "Why did we lose this deal? (1st why - surface reason)"
    - "Why did that factor work against us? (2nd why)"
    - "Why were we unprepared or outmaneuvered? (3rd why)"
    - "Why did our process/approach fail here? (4th why)"
    - "What systemic issue enabled this failure? (5th why - root cause)"

  learnings_extraction:
    - "What worked well that we should repeat?"
    - "What didn't work that we should change?"
    - "What competitive intelligence did we gain?"
    - "What product feedback should be shared?"
    - "What process improvements are needed?"

# ==============================================================================
# DECISION LOGIC
# ==============================================================================
decision_logic:
  rules:
    # Win with strong replicable factors
    - id: "replicable_win_pattern"
      condition: "outcome == 'won' AND win_factors.replicable_count >= 2"
      severity: "LOW"
      output_type: "Initiative"
      decision:
        title: "Win pattern identified for {node}"
        context: "Multiple replicable success factors found"
        recommendation: "Document and share win pattern with broader team"
        actions:
          - "Create win pattern playbook entry"
          - "Share learnings with SA/AE community"
          - "Update competitive positioning based on what worked"
        stakeholders: ["Sales Leadership", "SA Community", "CI Agent"]

    # Loss with controllable root cause
    - id: "controllable_loss_factor"
      condition: "outcome == 'lost' AND root_cause.controllable == true"
      severity: "MEDIUM"
      output_type: "Initiative + Action Items"
      decision:
        title: "Preventable loss factor identified: {root_cause_summary}"
        context: "Five Whys analysis revealed controllable root cause"
        recommendation: "Implement corrective actions to prevent recurrence"
        actions:
          - "Create action items for process improvement"
          - "Update playbooks or training materials"
          - "Monitor for pattern in other deals"
        stakeholders: ["AE", "SA", "Sales Leadership"]
      creates:
        - object_type: "Initiative"
          priority: "HIGH"

    # Loss to specific competitor
    - id: "competitive_loss"
      condition: "outcome == 'lost' AND competitor_won IS NOT NULL"
      severity: "MEDIUM"
      output_type: "Initiative"
      decision:
        title: "Competitive loss to {competitor_won}: Update battlecard"
        context: "Lost deal provides competitive intelligence"
        recommendation: "Update competitive positioning and battlecards"
        actions:
          - "CI Agent: Update battlecard for {competitor_won}"
          - "Document competitive tactics observed"
          - "Identify proof points needed to counter"
        stakeholders: ["CI Agent", "SA Community"]

    # Product gap contributed to loss
    - id: "product_gap_loss"
      condition: "outcome == 'lost' AND product_gap.identified == true"
      severity: "HIGH"
      output_type: "Risk + Initiative"
      decision:
        title: "Product gap contributed to loss: {product_gap.description}"
        context: "Customer requirement not met by current product"
        recommendation: "Escalate to Product team for roadmap consideration"
        actions:
          - "Document product gap with customer evidence"
          - "Submit to Product feedback system"
          - "Track similar feedback from other deals"
        escalate_to: "Product Team"
      creates:
        - object_type: "Risk"
          category: "product"
          severity: "MEDIUM"

    # Resurrection potential for loss
    - id: "resurrection_opportunity"
      condition: "outcome == 'lost' AND resurrection_potential == 'HIGH'"
      severity: "LOW"
      output_type: "Initiative"
      decision:
        title: "Resurrection opportunity for {node}"
        context: "Lost deal has potential to return"
        recommendation: "Implement nurture strategy"
        actions:
          - "Document conditions for re-engagement"
          - "Set reminder for check-in"
          - "Maintain champion relationship"

# ==============================================================================
# FIVE WHYS METHODOLOGY FOR RETROSPECTIVES
# ==============================================================================
five_whys_methodology:
  for_wins:
    purpose: "Identify replicable success patterns"
    focus: "What systematic advantage led to this win?"
    output: "Success pattern documentation for replication"
    example:
      problem: "Why did we win this deal?"
      why_1: "Our demo showed exactly what they needed for their SIEM consolidation"
      why_2: "We understood their specific compliance requirements beforehand"
      why_3: "Our champion gave us detailed intel on their evaluation criteria"
      why_4: "We invested heavily in relationship building during discovery"
      why_5: "Our account planning process emphasizes early stakeholder mapping"
      root_success_factor: "Disciplined discovery and stakeholder engagement process"
      replicable: true

  for_losses:
    purpose: "Identify preventable failure patterns"
    focus: "What systemic issue led to this loss?"
    output: "Corrective actions and process improvements"
    example:
      problem: "Why did we lose this deal to competitor X?"
      why_1: "They demonstrated faster time-to-value in POC"
      why_2: "Their POC scope was narrower and more focused"
      why_3: "We tried to show too many capabilities at once"
      why_4: "We didn't understand their primary success metric"
      why_5: "Our discovery questions focused on our products, not their priorities"
      root_cause: "Discovery process doesn't adequately capture customer success metrics"
      controllable: true
      corrective_action: "Add success metrics questions to discovery playbook"

  branching_in_retrospectives:
    when_to_branch:
      - "Multiple independent factors contributed to outcome"
      - "Technical and commercial factors both significant"
      - "Different stakeholders have different perspectives"
    handling:
      - "Create separate analysis chains"
      - "Identify which root causes are most impactful"
      - "Prioritize corrective actions by impact"

# ==============================================================================
# EXPECTED OUTPUTS
# ==============================================================================
expected_outputs:
  primary_artifact:
    path: "infohub/{realm}/{node}/retrospectives/retrospective_{YYYY-MM-DD}.md"
    format: "markdown"
    sections:
      - executive_summary
      - deal_snapshot
      - outcome_analysis
      - five_whys_analysis
      - key_learnings
      - recommendations
      - resurrection_assessment (losses only)

    schema:
      executive_summary:
        - outcome: "enum[WON|LOST|NO_DECISION]"
        - deal_value: "number"
        - primary_outcome_driver: "string"
        - root_cause: "string"
        - key_learning: "string"

      deal_snapshot:
        - account_name: "string"
        - opportunity_name: "string"
        - deal_value: "number"
        - sales_cycle_days: "integer"
        - competitors: "array[string]"
        - ae: "string"
        - sa: "string"

      outcome_analysis:
        - primary_drivers: "array[driver_detail]"
        - contributing_factors: "array[string]"
        - warning_signs: "array[string] (for losses)"
        - what_we_did_well: "array[string]"
        - what_we_could_improve: "array[string]"

      five_whys_analysis:
        - chain: "array[why_level]"
        - root_cause_or_success_factor: "string"
        - category: "enum[process|communication|product|competitive|resource|external]"
        - controllable: "boolean"
        - branches: "array[five_whys_analysis] (if multiple root causes)"

      key_learnings:
        - learning: "string"
        - category: "enum[sales|technical|competitive|product|process]"
        - applicability: "enum[universal|segment|account]"
        - action_recommended: "string"

      recommendations:
        - immediate_actions: "array[action_item]"
        - process_improvements: "array[improvement]"
        - competitive_updates: "array[string]"
        - product_feedback: "array[feedback_item]"

  action_items:
    path: "infohub/{realm}/{node}/actions/"
    create_for: "All recommendations with specific owners"

  competitive_intelligence:
    path: "infohub/{realm}/{node}/competitive/"
    create_if: "competitive insights gathered"

  notifications:
    - recipient: "Sales Leadership"
      condition: "always"
      message: "Retrospective complete for {node}: {outcome} - {key_learning}"

    - recipient: "CI Agent"
      condition: "competitor_insights.count > 0"
      message: "Competitive intelligence from {node} retrospective"

    - recipient: "Product Team"
      condition: "product_feedback.count > 0"
      message: "Product feedback from {node} retrospective: {product_feedback.summary}"

# ==============================================================================
# STOP CONDITIONS
# ==============================================================================
stop_conditions:
  escalate_to_human:
    - condition: "sensitive_personnel_issues"
      reason: "Retrospective involves sensitive personnel matters"
      action: "Human facilitator required"

    - condition: "contradictory_accounts"
      reason: "Team members have significantly different recollections"
      action: "Facilitated discussion needed to reconcile"

    - condition: "executive_deal"
      reason: "Deal involves executive relationships requiring discretion"
      action: "Leadership review before finalization"

  insufficient_data:
    - "Key participants not available for input"
    - "Deal history not documented"
    - "No competitive context available for loss analysis"

  ambiguity_signals:
    - "Root cause unclear despite multiple analysis paths"
    - "Multiple equally valid explanations for outcome"
    - "Evidence contradicts stated reasons"

# ==============================================================================
# VALIDATION CHECKS
# ==============================================================================
validation_checks:
  pre_execution:
    - "Deal is closed"
    - "Minimum 7 days since close"
    - "At least AE or SA available for input"
    - "Basic deal timeline available"

  post_execution:
    - "Five Whys analysis reaches root cause (not just symptoms)"
    - "At least 3 key learnings documented"
    - "At least 1 actionable recommendation"
    - "Evidence cited for key conclusions"

  output_quality:
    - "Root cause is specific and actionable (if controllable)"
    - "Learnings are applicable beyond this specific deal"
    - "Recommendations have clear owners"
    - "No blame assigned to individuals"

# ==============================================================================
# EXECUTION METADATA
# ==============================================================================
estimated_execution_time: "30-60 minutes (agent) + participant input"
frequency: "Within 7 days of deal close"
human_review_required: true
approval_workflow:
  - reviewer: "AE"
    approval_gate: "Validate facts and analysis accuracy"
  - reviewer: "SA"
    approval_gate: "Validate technical analysis and learnings"
  - reviewer: "Sales Manager"
    condition: "deal_value >= ${thresholds.strategic_deal_value}"
    approval_gate: "Review and approve for broader sharing"

last_updated: "2026-01-21"
version: "1.0"
status: "production_ready"
notes: "Integrates Five Whys methodology for root cause analysis in retrospectives"

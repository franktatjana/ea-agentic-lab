# Canvas Spec: Architecture Communication Canvas
# Visual artifact for communicating proposed solution architecture to stakeholders
# Based on arc42 Architecture Communication Canvas

canvas_id: architecture_communication
version: "1.0"
name: "Architecture Communication Canvas"
description: "One-page architecture overview for stakeholder communication - what the solution does, how it works, and key decisions"

# ==============================================================================
# CANVAS SECTIONS
# ==============================================================================
sections:
  value_proposition:
    label: "Value Proposition"
    prompt: "Major objectives. What value does the system deliver? What are the major business goals?"
    required: true
    max_items: 5
    source:
      type: "infohub"
      path: "value/value_hypothesis.yaml"
      field: "business_outcomes"

  core_functions:
    label: "Core Functions"
    prompt: "What are the most important functions of the system? What activities or processes does it offer?"
    required: true
    max_items: 6
    source:
      type: "infohub"
      path: "architecture/solution_design.yaml"
      field: "capabilities"

  core_decisions:
    label: "Core Decisions - Good or Bad"
    prompt: "Which decisions led to the current state of the system? Include both successful and problematic choices."
    required: true
    max_items: 5
    source:
      type: "infohub"
      path: "decisions/"
      filter: "category == 'architecture'"
      aggregate: "summary_with_outcome"

  technologies:
    label: "Technologies"
    prompt: "Important technologies used for development and operation."
    required: true
    max_items: 8
    source:
      type: "infohub"
      path: "architecture/tech_stack.yaml"
      merge: "architecture/solution_design.yaml → components"

  key_stakeholders:
    label: "Key Stakeholders"
    prompt: "For whom are we creating value? Who is paying for development? Who are our most important customers?"
    required: true
    max_items: 5
    source:
      type: "infohub"
      path: "context/stakeholder_map.yaml"
      filter: "influence >= high OR role IN ['sponsor', 'champion', 'decision_maker']"

  quality_requirements:
    label: "Quality Requirements"
    prompt: "Speed, scalability, reliability, usability, security, safety, capacity or similar."
    required: true
    max_items: 6
    source:
      type: "derived"
      from: ["discovery/requirements.yaml", "poc/success_criteria.yaml"]
      filter: "type == 'non_functional'"

  business_context:
    label: "Business Context"
    prompt: "What are the most important external interfaces or neighboring systems? Communication partners."
    required: true
    max_items: null
    source:
      type: "infohub"
      path: "architecture/current_state.yaml"
      field: "integrations"
      merge: "architecture/solution_design.yaml → external_interfaces"

  components_modules:
    label: "Components / Modules"
    prompt: "Major building blocks of the system."
    required: true
    max_items: 8
    source:
      type: "infohub"
      path: "architecture/solution_design.yaml"
      field: "components"

  core_risks:
    label: "Core Risks and Missing Information"
    prompt: "Potential problems and risks. What information is missing or has gotten lost? What is hindering the team?"
    required: true
    max_items: 5
    source:
      type: "infohub"
      path: "risks/"
      filter: "category IN ['technical', 'architecture', 'integration']"
      aggregate: "active_risks_summary"

# ==============================================================================
# METADATA FIELDS
# ==============================================================================
metadata:
  system_name:
    label: "System"
    source: "context/overview.yaml → solution_name"
    position: "header"
  created_for:
    label: "Created for"
    source: "render_context → audience"
  date:
    source: "render_timestamp"
  iteration:
    source: "render_version"

# ==============================================================================
# RENDER TRIGGERS
# ==============================================================================
triggers:
  on_create:
    - "Solution design created"
    - "POC architecture defined"
  on_update:
    - "Architecture decision added"
    - "Tech stack updated"
    - "New integration identified"
    - "Risk register updated with technical risk"
  scheduled:
    - frequency: "monthly"
      condition: "opportunity.stage IN ['Stage 3', 'Stage 4'] OR account.status == 'implementation'"

# ==============================================================================
# VALIDATION RULES
# ==============================================================================
validation:
  completeness:
    minimum_sections:
      - "value_proposition"
      - "core_functions"
      - "components_modules"
      - "technologies"
    warning_if_missing:
      - "core_decisions"
      - "core_risks"
      - "quality_requirements"

  consistency:
    - rule: "technologies should align with components"
      severity: "warning"
    - rule: "quality_requirements should have corresponding risks or decisions"
      severity: "info"
    - rule: "business_context integrations should appear in components or technologies"
      severity: "warning"

# ==============================================================================
# OUTPUT PATHS
# ==============================================================================
output:
  markdown:
    path: "{realm}/{node}/external-infohub/canvas/architecture_communication_{context_id}.md"
  html:
    path: "{realm}/{node}/external-infohub/canvas/architecture_communication_{context_id}.html"
    template: "playbooks/canvas/templates/architecture_communication.html"

# ==============================================================================
# LAYOUT HINTS
# ==============================================================================
layout:
  grid: "3x3 + footer"
  rows:
    - sections: ["value_proposition", "core_functions", "core_decisions", "technologies"]
      height: "medium"
    - sections: ["key_stakeholders", "quality_requirements"]
      height: "medium"
    - sections: ["business_context", "components_modules"]
      height: "large"
  footer:
    sections: ["core_risks"]
    style: "highlighted"
